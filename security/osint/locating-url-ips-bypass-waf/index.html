<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Locating IPs that respond to a URL" /><meta name="author" content="Helvio Junior (m4v3r1ck)" /><meta property="og:locale" content="en_US" /><meta name="description" content="Perform the WAF bypass using Web Finder to locate addresses that respond to the site without WAF." /><meta property="og:description" content="Perform the WAF bypass using Web Finder to locate addresses that respond to the site without WAF." /><link rel="canonical" href="https://www.helviojunior.com.br/security/osint/locating-url-ips-bypass-waf/" /><meta property="og:url" content="https://www.helviojunior.com.br/security/osint/locating-url-ips-bypass-waf/" /><meta property="og:site_name" content="Helvio Junior" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-10-31T21:00:00-03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Locating IPs that respond to a URL" /><meta name="twitter:site" content="@helvioju" /><meta name="twitter:creator" content="@Helvio Junior (m4v3r1ck)" /><meta name="google-site-verification" content="JR4IIP9jfvOwxn2ybV_Qn0SrtDPlTrKomdPWgBuP55k"" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Helvio Junior (m4v3r1ck)"},"dateModified":"2024-11-01T10:00:41-03:00","datePublished":"2024-10-31T21:00:00-03:00","description":"Perform the WAF bypass using Web Finder to locate addresses that respond to the site without WAF.","headline":"Locating IPs that respond to a URL","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.helviojunior.com.br/security/osint/locating-url-ips-bypass-waf/"},"url":"https://www.helviojunior.com.br/security/osint/locating-url-ips-bypass-waf/"}</script><title>Locating IPs that respond to a URL | Helvio Junior</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Helvio Junior"><meta name="application-name" content="Helvio Junior"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/m4v3r1ck.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Helvio Junior</a></div><div class="site-subtitle font-italic">Cyber security researcher, speaker, low level and binary exploitation entusiast. <br /><br />"I’m just a child who has never grown up. I still keep asking these 'how' & 'why' questions. Occasionally, I find an answer. Stephen Hawking"</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://www.linkedin.com/in/helviojunior" aria-label="linkedin" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.youtube.com/@Sec4US" aria-label="youtube" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="https://github.com/helviojunior" aria-label="github" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['helvio.junior','sec4us.com.br'].join('@')" aria-label="email" class="order-6" > <i class="fas fa-envelope"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/security"> Security </a> </span> <span> <a href="/osint"> Osint </a> </span> <span>Locating IPs that respond to a URL</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Locating IPs that respond to a URL</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Helvio Junior (m4v3r1ck) </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Oct 31, 2024, 9:00 PM -0300" prep="on" > Oct 31 <i class="unloaded">2024-10-31T21:00:00-03:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Fri, Nov 1, 2024, 10:00 AM -0300" prefix="Updated " > Nov 1 <i class="unloaded">2024-11-01T10:00:41-03:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1276 words">7 min</span></div></div><div class="post-content"> <a href="/assets/2024/10/e52cfdb1d4783a4b933ba33b548f54a4.png" class="popup img-link preview-img"><img data-src="/assets/2024/10/e52cfdb1d4783a4b933ba33b548f54a4.png" alt="Web Finder" class="lazyload" data-proofer-ignore></a><h2 id="introduction"><span class="me-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Web Finder aims to assist in locating IP addresses that respond to a specific URL, thus enabling the WAF bypass.</p><h2 id="technical-concept"><span class="me-2">Technical Concept</span><a href="#technical-concept" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>When making an HTTP/S request to a host, the first step for the client is resolving the name to an IP address, followed by a direct connection to that IP. This procedure pertains to the Transport layer of the OSI model (Layer 4), where only the IP and port are involved. Once the TCP connection is successfully established, the client constructs an HTTP request header and sends it to the server. See the following example:</p><p>Assuming that a browser is directed to https://www.helviojunior.com.br (as shown in the curl command below), the client will first resolve the DNS name to the IP (which will result in 54.244.151.52) and then send the header as follows:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl <span class="nt">-k</span> https://www.helviojunior.com.br
</pre></table></code></div></div><p>Header:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>GET / HTTP/1.1
Host: www.helviojunior.com.br
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:89.0) Gecko/20100101 Firefox/89.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: pt-BR,pt;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Upgrade-Insecure-Requests: 1
Te: trailers
Connection: close
</pre></table></code></div></div><p>As we can see in the ‘Host’ header, we have the full name of the server. With the advent of HTTP 1.1 and onwards, the server considers this field to internally route which site it should respond to. If the server is prepared to respond to this host (www.helviojunior.com.br), it will do so.</p><p>However, we can perform the same process differently by directing the client to connect to a specific IP address and forcing the host in the HTTP header, as shown in the command below:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl <span class="nt">-k</span> <span class="nt">-H</span> <span class="s1">'Host: www.helviojunior.com.br'</span> https://54.244.151.52
</pre></table></code></div></div><p>In this way, the TCP connection will necessarily occur to the IP 54.244.151.52 regardless of the DNS resolution; however, the HTTP header will send the host www.helviojunior.com.br. This way, we will obtain the same result in response.</p><p>However, we can change the IP address to any other, such as 10.10.10.10. If the server at this IP exists and is prepared to respond to the site www.helviojunior.com.br, the response (HTTP status code and size) will be the same.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl <span class="nt">-k</span> <span class="nt">-H</span> <span class="s1">'Host: www.helviojunior.com.br'</span> https://10.10.10.10
</pre></table></code></div></div><blockquote class="prompt-warning"><p>However, in the scenario above, the <code class="language-plaintext highlighter-rouge">Subject Name</code> provided via <code class="language-plaintext highlighter-rouge">SNI</code> will be the IP instead of the <code class="language-plaintext highlighter-rouge">host</code>, so in cases where TLS requires SNI, the command above will not work. Therefore, we will need to use another strategy.</p></blockquote><p>For this, we will use the <code class="language-plaintext highlighter-rouge">--resolve [DOMAIN]:[PORT]:[IP]</code> parameter of CURL.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl <span class="nt">-k</span> <span class="nt">--resolve</span> www.helviojunior.com.br:443:54.244.151.52 https://www.helviojunior.com.br
</pre></table></code></div></div><p>This way, just like in the previous scenario, the TCP connection will necessarily occur to the IP 54.244.151.52 since the <code class="language-plaintext highlighter-rouge">--resolve</code> parameter ignores name resolution via DNS. Additionally, this way the <code class="language-plaintext highlighter-rouge">host</code> header and the <code class="language-plaintext highlighter-rouge">Subject Name</code> of the <code class="language-plaintext highlighter-rouge">SNI</code> will be set correctly.”</p><p>Thus, we can use this technique to provide a list of IPs and check if they are configured to respond to a specific site.</p><h2 id="setup"><span class="me-2">Setup</span><a href="#setup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="installing-pipx"><span class="me-2">Installing pipx</span><a href="#installing-pipx" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote class="prompt-warning"><p>We recommend using <code class="language-plaintext highlighter-rouge">pipx</code> over <code class="language-plaintext highlighter-rouge">pip</code> for system-wide installations.</p></blockquote><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>python3 <span class="nt">-m</span> pip <span class="nb">install </span>pipx
python3 <span class="nt">-m</span> pipx ensurepath
</pre></table></code></div></div><h3 id="installing-web-finder"><span class="me-2">Installing Web Finder</span><a href="#installing-web-finder" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python3 <span class="nt">-m</span> pipx <span class="nb">install </span>wafwebfinder
</pre></table></code></div></div><h2 id="practical-example"><span class="me-2">Practical Example</span><a href="#practical-example" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In this tutorial, we will conduct the test with the service from X (formerly Twitter). The motivation for this exercise stems from the fact that it recently transitioned its service to a CDN to avoid blocks imposed in Brazil.</p><h3 id="ip-enumeration"><span class="me-2">IP Enumeration</span><a href="#ip-enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The first necessary step is to collect/enumerate possible IPs. For this process, we will use three different techniques:</p><ol><li>Active enumeration via DNS brute force<li>Passive enumeration through VirusTotal<li>Passive enumeration through Shodan</ol><h3 id="enumdns"><span class="me-2">EnumDNS</span><a href="#enumdns" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">enumdns</code> is a script created by me and is available at <a href="https://github.com/helviojunior/libs/blob/master/python/enumdns.py">https://github.com/helviojunior/libs/blob/master/python/enumdns.py</a>.</p><p>Download the SecList (wordlist we will use).</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">mkdir</span> <span class="nt">-p</span> /usr/share/wordlists/
<span class="nb">cd</span> /usr/share/wordlists/
git clone https://github.com/danielmiessler/SecLists
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">cd</span> ~
wget https://raw.githubusercontent.com/helviojunior/libs/master/python/enumdns.py
python3 enumdns.py <span class="nt">-d</span> x.com <span class="nt">-w</span> /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt <span class="nt">-o</span> enumdns.txt
</pre></table></code></div></div><p><a href="/assets/2024/10/190a4c7725bd4eced57d42c1e62a331c.png" class="img-link shimmer" ><img data-src="/assets/2024/10/190a4c7725bd4eced57d42c1e62a331c.png" alt="" class="lazyload" data-proofer-ignore></a></p><blockquote class="prompt-tip"><p>Keep the generated file <code class="language-plaintext highlighter-rouge">enumdns.txt</code> so we can later filter the IPs.</p></blockquote><h3 id="virus-total"><span class="me-2">Virus Total</span><a href="#virus-total" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Access <a href="https://www.virustotal.com/">VirusTotal</a> and enter the desired URL, perform the search, and then click on <strong>Relations</strong>.</p><p><a href="/assets/2024/10/77d12c98a1c531556aba5b6932152307.png" class="img-link shimmer" ><img data-src="/assets/2024/10/77d12c98a1c531556aba5b6932152307.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>In the <strong>Relations</strong> tab, we will see several IP addresses.</p><p><a href="/assets/2024/10/aabac0b30c726f5f712a93d426f1b351.png" class="img-link shimmer" ><img data-src="/assets/2024/10/aabac0b30c726f5f712a93d426f1b351.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Select all the text/HTML from the site, copy it, and paste it into a text file.</p><blockquote class="prompt-tip"><p>Don’t worry if other texts appear in this process, as we will filter only the IP addresses later.</p></blockquote><p><a href="/assets/2024/10/4444a223d6c4a4d00fd6e31befb70836.png" class="img-link shimmer" ><img data-src="/assets/2024/10/4444a223d6c4a4d00fd6e31befb70836.png" alt="" class="lazyload" data-proofer-ignore></a></p><h3 id="shodan"><span class="me-2">Shodan</span><a href="#shodan" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>View all the addresses listed by Shodan through the URL <code class="language-plaintext highlighter-rouge">https://www.shodan.io/domain/{DOMAIN}</code>, replacing <code class="language-plaintext highlighter-rouge">{DOMAIN}</code> with the desired domain. Example: <code class="language-plaintext highlighter-rouge">https://www.shodan.io/domain/x.com</code></p><p><a href="/assets/2024/10/618f3f3a0794120172d8cc00c2f80aa2.png" class="img-link shimmer" ><img data-src="/assets/2024/10/618f3f3a0794120172d8cc00c2f80aa2.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Select all the text/HTML from the site, copy it, and paste it into a text file.</p><blockquote class="prompt-tip"><p>Again, don’t worry if other texts appear in this process, as we will filter only the IP addresses later.</p></blockquote><p><a href="/assets/2024/10/37a2c22f6076173c08a89280b5904a8d.png" class="img-link shimmer" ><img data-src="/assets/2024/10/37a2c22f6076173c08a89280b5904a8d.png" alt="" class="lazyload" data-proofer-ignore></a></p><h3 id="filtering-only-ips"><span class="me-2">Filtering Only IPs</span><a href="#filtering-only-ips" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Save all the previously obtained content in a single text file.</p><p>For illustration purposes, here’s a <code class="language-plaintext highlighter-rouge">grep</code> command to filter only the lines with IPv4 addresses.</p><p><a href="/assets/2024/10/e60c561c311d427950957071b85c32ae.png" class="img-link shimmer" ><img data-src="/assets/2024/10/e60c561c311d427950957071b85c32ae.png" alt="" class="lazyload" data-proofer-ignore></a></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">cat </span>tmp.txt | <span class="nb">grep</span> <span class="nt">-E</span> <span class="s1">'[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}'</span>
</pre></table></code></div></div><p>Now we will obtain the IP addresses, sort them, and filter for unique addresses.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">cat </span>tmp.txt | <span class="nb">grep</span> <span class="nt">-oE</span> <span class="s1">'[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}'</span> | <span class="nb">sort</span> <span class="nt">-u</span> <span class="o">&gt;</span> tst.txt
</pre></table></code></div></div><p><a href="/assets/2024/10/d15cfa665415a650552fbe06a6a90514.png" class="img-link shimmer" ><img data-src="/assets/2024/10/d15cfa665415a650552fbe06a6a90514.png" alt="" class="lazyload" data-proofer-ignore></a></p><h2 id="expanding-the-search"><span class="me-2">Expanding the Search</span><a href="#expanding-the-search" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In some scenarios, it may be necessary to expand the search to all <code class="language-plaintext highlighter-rouge">/24</code> subnets of the found IPs.</p><blockquote class="prompt-tip"><p>This step is not mandatory, but it can be important to broaden the search and find other addresses that were not listed in the previous steps. In a cloud environment, many IPs may come up that likely do not fall within the scope of the test, but in an on-premises environment, the accuracy is quite high.</p></blockquote><p>To do this, we will extract only the subnets:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">for </span>net <span class="k">in</span> <span class="si">$(</span><span class="nb">cat</span> <span class="k">*</span>.txt | <span class="nb">grep</span> <span class="nt">-oE</span> <span class="s1">'[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.'</span><span class="si">)</span>:<span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">net</span><span class="k">}</span><span class="s2">0/24"</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sort</span> <span class="nt">-u</span> <span class="o">&gt;</span> subnets.txt
</pre></table></code></div></div><p>Then perform an NMAP scan to locate the addresses that respond to HTTP and HTTPS.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap <span class="nt">-Pn</span> <span class="nt">-v</span> <span class="nt">-T4</span> <span class="nt">-sTV</span> <span class="nt">-p80</span>,443 <span class="nt">-iL</span> subnets.txt | <span class="nb">tee</span> <span class="nt">-a</span> nmap_subnets_1.txt
</pre></table></code></div></div><p>After finishing, we can filter the addresses.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">cat </span>nmap_subnets_1.txt | <span class="nb">grep</span> <span class="s1">'open port'</span> | <span class="nb">grep</span> <span class="s1">'443\|80'</span> | <span class="nb">grep</span> <span class="nt">-oE</span> <span class="s1">'[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}'</span> | <span class="nb">sort</span> <span class="nt">-u</span> <span class="o">&gt;</span> tst.txt
</pre></table></code></div></div><h2 id="using-webfinder"><span class="me-2">Using WebFinder</span><a href="#using-webfinder" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now that we have a list of IPs, we can use it to check which servers respond to the desired service.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>webfinder <span class="nt">-t</span> https://x.com/ <span class="nt">-ip</span> tst.txt <span class="nt">-o</span> x.txt <span class="nt">--random-agent</span>
</pre></table></code></div></div><blockquote class="prompt-tip"><p>The command above will respect the protocol specified by the URL (<code class="language-plaintext highlighter-rouge">http</code> or <code class="language-plaintext highlighter-rouge">https</code>). If you want to search both protocols, just use the <code class="language-plaintext highlighter-rouge">--check-both</code> parameter.</p></blockquote><h3 id="blind-check"><span class="me-2">Blind Check</span><a href="#blind-check" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In its default search mode, Web Finder will first connect to the original site and obtain the return code as well as the size of the response body. This process aims to understand the pattern of the original site before searching for the same pattern directly on the provided IP addresses.</p><p>However, there are some scenarios where access to the original site is not possible for various reasons, such as blocks, network connectivity, etc. In these cases, Web Finder has a <code class="language-plaintext highlighter-rouge">--static</code> parameter that allows you to specify the expected return code (e.g., 200, 204, 404, 500, etc.) along with (or without) the expected response size.</p><p>Using the previous request as a basis, which returned a <code class="language-plaintext highlighter-rouge">200</code> code with a size of <code class="language-plaintext highlighter-rouge">2610 bytes</code>, we can execute it with two variants:</p><ol><li>Only the status code: <code class="language-plaintext highlighter-rouge">webfinder -t https://x.com/ -ip tst.txt -o x.txt --random-agent --static 200</code><li>Status code + size: <code class="language-plaintext highlighter-rouge">webfinder -t https://x.com/ -ip tst.txt -o x.txt --random-agent --static 200:2610</code></ol><p><a href="/assets/2024/10/1b37ddb9f2e6a31e014c213e3dcd93da.png" class="img-link shimmer" ><img data-src="/assets/2024/10/1b37ddb9f2e6a31e014c213e3dcd93da.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/2024/10/08b7be65907ca0cd20412d6525e3bd40.png" class="img-link shimmer" ><img data-src="/assets/2024/10/08b7be65907ca0cd20412d6525e3bd40.png" alt="" class="lazyload" data-proofer-ignore></a></p><blockquote class="prompt-warning"><p>Using <code class="language-plaintext highlighter-rouge">--static</code> with only the return code can lead to false positives, as the identification of the return may not be precise.</p></blockquote><h2 id="conclusion"><span class="me-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>As we have seen in this article, it is possible to obtain the IP addresses that respond to a specific service.</p><p>Additionally, the <code class="language-plaintext highlighter-rouge">webfinder</code> tool assists in this process and illustrates if the found IP is protected by a CDN and/or WAF.</p><p><a href="/assets/2024/10/5ac920de9474360e1ecbb465869b3c2d.png" class="img-link shimmer" ><img data-src="/assets/2024/10/5ac920de9474360e1ecbb465869b3c2d.png" alt="" class="lazyload" data-proofer-ignore></a></p><h2 id="references"><span class="me-2">References:</span><a href="#references" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="https://github.com/helviojunior/webfinder">Source Code</a><li><a href="https://pypi.org/project/WafWebFinder/">PyPi - Python Package Index</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/offensive-security/'>Offensive Security</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/offensive-security/" class="post-tag no-text-decoration" >Offensive Security</a> <a href="/tags/waf/" class="post-tag no-text-decoration" >WAF</a> <a href="/tags/bypass-waf/" class="post-tag no-text-decoration" >Bypass WAF</a> <a href="/tags/pentest/" class="post-tag no-text-decoration" >Pentest</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Locating IPs that respond to a https://www.helviojunior.com.br/security/osint/locating-url-ips-bypass-waf/ - Helvio Junior&url=https://www.helviojunior.com.br/security/osint/locating-url-ips-bypass-waf/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Locating IPs that respond to a https://www.helviojunior.com.br/security/osint/locating-url-ips-bypass-waf/ - Helvio Junior&u=https://www.helviojunior.com.br/security/osint/locating-url-ips-bypass-waf/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Locating IPs that respond to a https://www.helviojunior.com.br/security/osint/locating-url-ips-bypass-waf/ - Helvio Junior&url=https://www.helviojunior.com.br/security/osint/locating-url-ips-bypass-waf/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.helviojunior.com.br/security/osint/locating-url-ips-bypass-waf/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/security/osint/localizando-ips-que-respondem-para-uma-url/">Localizando IPs que respondem para uma URL</a><li><a href="/security/osint/locating-url-ips-bypass-waf/">Locating IPs that respond to a URL</a><li><a href="/security/edr/instalando-elasticsearch-edr/">Instalando Elasticsearch EDR</a><li><a href="/it/instalando-openvpn-com-autenticacao-em-mysql/">Instalando OpenVPN com autenticação em MySQL</a><li><a href="/it/osce-osed-e-ecxd-certificacoes-de-desenvolvimento-de-exploits/">OSCE, OSED e eCXD: Certificações de desenvolvimento de Exploits</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/offensive-security/">Offensive Security</a> <a class="post-tag" href="/tags/pentest/">Pentest</a> <a class="post-tag" href="/tags/autoridade-certificadora/">autoridade certificadora</a> <a class="post-tag" href="/tags/ca/">ca</a> <a class="post-tag" href="/tags/certificate-authority/">certificate authority</a> <a class="post-tag" href="/tags/openssl/">openssl</a> <a class="post-tag" href="/tags/osce3/">OSCE3</a> <a class="post-tag" href="/tags/buffer-overflow/">Buffer Overflow</a> <a class="post-tag" href="/tags/osed/">OSED</a> <a class="post-tag" href="/tags/osee/">OSEE</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/security/osint/localizando-ips-que-respondem-para-uma-url/"><div class="card-body"> <span class="timeago small" > Oct 31 <i class="unloaded">2024-10-31T20:00:00-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Localizando IPs que respondem para uma URL</h3><div class="text-muted small"><p> Introdução O Web Finder tem por objetivo auxiliar na localização de endereços IP que respondem por uma URL específica, podendo, desta forma ocorrer o Bypass do WAF. Conceito técnico Ao realizar u...</p></div></div></a></div><div class="card"> <a href="/it/oswe-uma-historia-de-insucessos/"><div class="card-body"> <span class="timeago small" > Dec 29, 2020 <i class="unloaded">2020-12-29T21:31:52-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>OSWE - Uma história de insucessos!</h3><div class="text-muted small"><p> Minha Jornada para a Certificação OSWE Estamos vivendo em um ano que certamente ficará marcado na história da humanidade, mas de forma especial na vida de muitos de nós. Desta forma, decidi escrev...</p></div></div></a></div><div class="card"> <a href="/it/security/criacao-de-exploits/shellcoding-encontrando-endereco-da-funcao-dinamicamente-analise-da-biblioteca-block_api/"><div class="card-body"> <span class="timeago small" > Aug 15, 2021 <i class="unloaded">2021-08-15T16:26:52-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Shellcoding - Encontrando endereço da função dinamicamente. Análise da biblioteca block_api</h3><div class="text-muted small"><p> Introdução Neste artigo iremos dissecar a biblioteca da Metasploit chamada Block API responsável por localizar em tempo de execução o endereço das funções dentro dos módulos carregados na aplicaçã...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/security/osint/localizando-ips-que-respondem-para-uma-url/" class="btn btn-outline-primary" prompt="Older"><p>Localizando IPs que respondem para uma URL</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Locating IPs that respond to a URL'; this.page.url = 'https://www.helviojunior.com.br/security/osint/locating-url-ips-bypass-waf/'; this.page.identifier = '/security/osint/locating-url-ips-bypass-waf/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/helviojunior">Helvio junior (aka M4v3r1ck)</a>. <span data-toggle="tooltip" data-placement="top" title="Some rights reserved.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/offensive-security/">Offensive Security</a> <a class="post-tag" href="/tags/pentest/">Pentest</a> <a class="post-tag" href="/tags/autoridade-certificadora/">autoridade certificadora</a> <a class="post-tag" href="/tags/ca/">ca</a> <a class="post-tag" href="/tags/certificate-authority/">certificate authority</a> <a class="post-tag" href="/tags/openssl/">openssl</a> <a class="post-tag" href="/tags/osce3/">OSCE3</a> <a class="post-tag" href="/tags/buffer-overflow/">Buffer Overflow</a> <a class="post-tag" href="/tags/osed/">OSED</a> <a class="post-tag" href="/tags/osee/">OSEE</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.helviojunior.com.br{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
