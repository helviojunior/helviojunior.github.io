<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Installing OpenVPN with MySQL Authentication" /><meta name="author" content="Helvio Junior (m4v3r1ck)" /><meta property="og:locale" content="en_US" /><meta name="description" content="OpenVPN is a Linux software used for creating VPN tunnels. In this article, I will demonstrate step-by-step how to install OpenVPN with the following prerequisites:" /><meta property="og:description" content="OpenVPN is a Linux software used for creating VPN tunnels. In this article, I will demonstrate step-by-step how to install OpenVPN with the following prerequisites:" /><link rel="canonical" href="https://www.helviojunior.com.br/en/it/installing-openvpn-with-mysql-authentication/" /><meta property="og:url" content="https://www.helviojunior.com.br/en/it/installing-openvpn-with-mysql-authentication/" /><meta property="og:site_name" content="Helvio Junior" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-06-22T16:38:05-03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Installing OpenVPN with MySQL Authentication" /><meta name="twitter:site" content="@helvioju" /><meta name="twitter:creator" content="@Helvio Junior (m4v3r1ck)" /><meta name="google-site-verification" content="JR4IIP9jfvOwxn2ybV_Qn0SrtDPlTrKomdPWgBuP55k"" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Helvio Junior (m4v3r1ck)"},"dateModified":"2020-06-22T16:38:05-03:00","datePublished":"2020-06-22T16:38:05-03:00","description":"OpenVPN is a Linux software used for creating VPN tunnels. In this article, I will demonstrate step-by-step how to install OpenVPN with the following prerequisites:","headline":"Installing OpenVPN with MySQL Authentication","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.helviojunior.com.br/en/it/installing-openvpn-with-mysql-authentication/"},"url":"https://www.helviojunior.com.br/en/it/installing-openvpn-with-mysql-authentication/"}</script><title>Installing OpenVPN with MySQL Authentication | Helvio Junior</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Helvio Junior"><meta name="application-name" content="Helvio Junior"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/m4v3r1ck.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Helvio Junior</a></div><div class="site-subtitle font-italic">Cyber security researcher, speaker, low level and binary exploitation entusiast. <br /><br />"I’m just a child who has never grown up. I still keep asking these 'how' & 'why' questions. Occasionally, I find an answer. Stephen Hawking"</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://www.linkedin.com/in/helviojunior" aria-label="linkedin" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.youtube.com/@Sec4US" aria-label="youtube" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="https://github.com/helviojunior" aria-label="github" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['helvio.junior','sec4us.com.br'].join('@')" aria-label="email" class="order-6" > <i class="fas fa-envelope"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/en"> En </a> </span> <span> <a href="/it"> It </a> </span> <span>Installing OpenVPN with MySQL Authentication</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Installing OpenVPN with MySQL Authentication</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Helvio Junior (m4v3r1ck) </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Jun 22, 2020, 4:38 PM -0300" prep="on" > Jun 22, 2020 <i class="unloaded">2020-06-22T16:38:05-03:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3758 words">20 min</span></div></div><div class="post-content"><p>OpenVPN is a Linux software used for creating VPN tunnels. In this article, I will demonstrate step-by-step how to install OpenVPN with the following prerequisites:</p><ul><li>The updated version of the OpenVPN repository itself;<li>Use of a digital certificate;<li>Authentication via MySQL database;<li>Python scripts for real-time data updating (connected user, disconnected user, and data traffic)</ul><p>More information and documentation on OpenVPN can be obtained at this address: <a href="https://openvpn.net/">https://openvpn.net/</a></p><h2 id="installing-packages-and-dependencies"><span class="me-2">Installing Packages and Dependencies</span><a href="#installing-packages-and-dependencies" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>First of all, it is necessary to install all the dependencies required for the correct functioning of the environment.</p><p>Adding OpenVPN Repository to the Environment</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# <span class="nb">echo</span> <span class="s2">"deb http://build.openvpn.net/debian/openvpn/stable </span><span class="sb">`</span>lsb_release <span class="nt">--codename</span> <span class="nt">--short</span><span class="sb">`</span><span class="s2"> main"</span> <span class="o">&gt;</span> /etc/apt/sources.list.d/openvpn-aptrepo.list
root@M4v3r1ck:~# curl <span class="nt">-s</span> https://swupdate.openvpn.net/repos/repo-public.gpg | apt-key add -
</pre></table></code></div></div><blockquote class="prompt-warning"><p>At the time I created this tutorial, the installation was on an Ubuntu 20.04, but the OpenVPN repository was not yet accepting its codename <code class="language-plaintext highlighter-rouge">focal</code>. Therefore, I used the Ubuntu 18.04 repository, as shown in the command line below.</p></blockquote><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# <span class="nb">echo</span> <span class="s2">"deb http://build.openvpn.net/debian/openvpn/stable bionic main"</span> <span class="o">&gt;</span> /etc/apt/sources.list.d/openvpn-aptrepo.list
</pre></table></code></div></div><p>Updating the Environment</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nt">-y</span> upgrade
</pre></table></code></div></div><p>Installing Packages and Dependencies</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# apt <span class="nb">install</span> <span class="nt">-y</span> openvpn easy-rsa libpam-mysql python python3 python3-pip libmariadb-dev python3-dev mariadb-client mariadb-server iptables-persistent
root@M4v3r1ck:~# pip3 <span class="nb">install </span>mysqlclient
</pre></table></code></div></div><h2 id="configuring-the-certificate-authority-ca"><span class="me-2">Configuring the Certificate Authority (CA)</span><a href="#configuring-the-certificate-authority-ca" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>OpenVPN is a TLS/SSL VPN. This means that it uses certificates to encrypt traffic between the server and clients. To issue reliable certificates, we need to set up our own simple certificate authority (CA).</p><p>Before starting the commands per se, I believe it’s very important to understand what we are doing. Since the topic of certificate authority is complex, I recommend reading this article I wrote on the subject (<a href="https://www.helviojunior.com.br/it/security/introducao-criptografia/">https://www.helviojunior.com.br/it/security/introducao-criptografia/</a>). To illustrate what we will be doing in terms of certificate authority (CA), observe the image below:</p><p><a href="http://www.helviojunior.com.br/wp-content/uploads/2020/06/Certificados.png" class="popup img-link "><img data-src="http://www.helviojunior.com.br/wp-content/uploads/2020/06/Certificados.png" alt="Certificates" class="lazyload" data-proofer-ignore></a> Note that in the image we illustrate four certificates:</p><ol><li><strong>Root CA</strong>: This is the highest authority in our structure. It’s from this that all other certificates are generated, so it will be the first certificate to be created, and the most important. Therefore, when creating a password for its private keys, create a complex password and keep it safe.<li><strong>Server</strong>: This will be the second certificate to be generated. It is used exclusively on the server and serves the function of allowing clients (OpenVPN) to trust your server.<li><strong>Client n</strong>: The client certificates are so the server can trust and be sure that the client was authorized by you to connect to your environment. It is recommended to have one certificate for each client, but depending on the criticality of your environment, you can use a single certificate for all clients since the authentication (in our case) will be through username and password. With the use of one certificate per client, you will have in practice two factors of authentication (one being the certificate and the other the username/password).</ol><p>To start, we can copy the easy-rsa template directory to our home directory with the make-cadir command:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# make-cadir ~/openvpn-ca
</pre></table></code></div></div><p>Let’s go to the newly created directory to start configuring the CA:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# <span class="nb">cd</span> ~/openvpn-ca
</pre></table></code></div></div><p>To configure the values our CA will use, we need to edit the <strong>vars</strong> file within the directory. Open this file (<strong>~/openvpn-ca/vars</strong>) now in your text editor.</p><p>Inside, you’ll find some variables that can be adjusted to determine how your certificates will be created. We only need to worry about some of them.</p><p>At the bottom of the file, locate the settings that define field standards for new certificates. It should look something like this:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>...
<span class="c">#set_var EASYRSA_REQ_COUNTRY    "US"</span>
<span class="c">#set_var EASYRSA_REQ_PROVINCE   "California"</span>
<span class="c">#set_var EASYRSA_REQ_CITY       "San Francisco"</span>
<span class="c">#set_var EASYRSA_REQ_ORG        "Copyleft Certificate Co"</span>
<span class="c">#set_var EASYRSA_REQ_EMAIL      "me@example.net"</span>
<span class="c">#set_var EASYRSA_REQ_OU         "My Organizational Unit"</span>
...
</pre></table></code></div></div><p>Edit the values to whatever you prefer, but don’t leave them blank:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>...
set_var EASYRSA_REQ_COUNTRY    <span class="s2">"BR"</span>
set_var EASYRSA_REQ_PROVINCE   <span class="s2">"SP"</span>
set_var EASYRSA_REQ_CITY       <span class="s2">"Sao Paulo"</span>
set_var EASYRSA_REQ_ORG        <span class="s2">"Helvio Junior"</span>
set_var EASYRSA_REQ_EMAIL      <span class="s2">"contato@helviojunior.com.br"</span>
set_var EASYRSA_REQ_OU         <span class="s2">"Helvio Junior Treinamentos"</span>
...
</pre></table></code></div></div><p>When you’re finished, save and close the file.</p><h2 id="building-the-root-certificate-authority-root-ca"><span class="me-2">Building the Root Certificate Authority (Root-CA)</span><a href="#building-the-root-certificate-authority-root-ca" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now, we can use the variables we defined and the easy-rsa utilities to build our certificate authority.</p><p>Make sure you’re in your CA directory, and then create your PKI and CA structure:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# <span class="nb">cd</span> ~/openvpn-ca
root@M4v3r1ck:~/openvpn-ca# ./easyrsa init-pki
root@M4v3r1ck:~/openvpn-ca# ./easyrsa build-ca
</pre></table></code></div></div><p>At this point, you will be asked for a passphrase for your CA’s keys, as well as the name of your CA.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre>Note: using Easy-RSA configuration from: ./vars

Using SSL: openssl OpenSSL 1.1.1f 31 Mar 2020

Enter New CA Key Passphrase:
Re-Enter New CA Key Passphrase:
Generating RSA private key, 2048 bit long modulus <span class="o">(</span>2 primes<span class="o">)</span>
......................................................+++++
..................+++++
e is 65537 <span class="o">(</span>0x010001<span class="o">)</span>
Can<span class="s1">'t load /root/openvpn-ca/pki/.rnd into RNG
140290726450496:error:2406F079:random number generator:RAND_load_file:Cannot open file:../crypto/rand/randfile.c:98:Filename=/root/openvpn-ca/pki/.rnd
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '</span>.<span class="s1">', the field will be left blank.
-----
Common Name (eg: your user, host, or server name) [Easy-RSA CA]:Helvio Junior CA

CA creation complete and you may now import and sign cert requests.
Your new CA certificate file for publishing is at:
/root/openvpn-ca/pki/ca.crt
</span></pre></table></code></div></div><p>At the end of this process, we have the public certificate of our CA (Public key within an X509 certificate) in the file <code class="language-plaintext highlighter-rouge">~/openvpn-ca/pki/ca.crt</code> and its respective private key in the file <code class="language-plaintext highlighter-rouge">~/openvpn-ca/pki/private/ca.key</code>. Later, when we are creating the configuration file for our OpenVPN client, we will use the content of this X509 certificate file <code class="language-plaintext highlighter-rouge">~/openvpn-ca/pki/ca.crt</code>.</p><h2 id="creating-key-and-encryption-files"><span class="me-2">Creating Key and Encryption Files</span><a href="#creating-key-and-encryption-files" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Next, we will generate some additional files used during the encryption process.</p><p>First, we’ll generate strong Diffie-Hellman keys to use during the key exchange by typing:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~/openvpn-ca# ./easyrsa gen-dh
</pre></table></code></div></div><p>Afterwards, we can generate an HMAC signature to strengthen the server’s TLS integrity verification features:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~/openvpn-ca# openvpn <span class="nt">--genkey</span> <span class="nt">--secret</span> ~/openvpn-ca/pki/private/ta.key
</pre></table></code></div></div><p>This process will result in the file <code class="language-plaintext highlighter-rouge">~/openvpn-ca/pki/private/ta.key</code>, which we will also use when generating the OpenVPN client configuration.</p><h2 id="creating-the-server-certificate"><span class="me-2">Creating the Server Certificate</span><a href="#creating-the-server-certificate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Next, we will generate our server certificate and its respective private key.</p><blockquote class="prompt-warning"><p>If you choose a different name than <code class="language-plaintext highlighter-rouge">server</code> here, you will need to adjust some of the instructions below. For example, when copying the generated files to the <code class="language-plaintext highlighter-rouge">/etc/openvpn</code> directory, you will have to replace them with the correct names. You will also need to modify the <code class="language-plaintext highlighter-rouge">/etc/openvpn/server.conf</code> file later to point to the correct <code class="language-plaintext highlighter-rouge">.crt</code> and <code class="language-plaintext highlighter-rouge">.key</code> files.</p></blockquote><p>Start by generating the OpenVPN server certificate and key pair. We can do this by typing:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~/openvpn-ca# ./easyrsa build-server-full server nopass
</pre></table></code></div></div><p>This process generated 2 files <code class="language-plaintext highlighter-rouge">~/openvpn-ca/pki/issued/server.crt</code> and <code class="language-plaintext highlighter-rouge">~/openvpn-ca/pki/private/server.key</code>.</p><blockquote class="prompt-warning"><p>Note that in this command we pass the <code class="language-plaintext highlighter-rouge">nopass</code> parameter which will leave our server’s private key without a password. This poses a certain security risk but is necessary because if this key had a password, you would have to enter the password on the console every server reboot or OpenVPN service restart, which could cause a service failure.</p></blockquote><h2 id="creating-the-client-certificate"><span class="me-2">Creating the Client Certificate</span><a href="#creating-the-client-certificate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Next, we will generate our client certificate and its respective private key. As previously mentioned, you have 2 models of client deployment, the first less secure where you generate only 1 certificate for all clients, and another more secure where you generate a certificate for each client. Each model has its advantages and disadvantages, some of which are listed below:</p><ul><li>One certificate for ALL clients:<ol><li>Low cost of creating new clients, as it is enough to add them in the database (since the configuration file is the same for all);<li>If unauthorized people have access to the configuration file, they can carry out a brute force attack on the username and password in such a way that there is no way to trace which client leaked the configuration;<li>Very much in line with the item above, if it is necessary to revoke the digital client certificate, you will have to resend the configuration to all clients;</ol><li>One certificate for EACH client:<ol><li>Medium cost of creating new clients, as for each new client it is necessary to generate the digital certificate, private key, and create a new configuration file with this certificate and key;<li>Easy traceability in case of configuration leakage as the certificate is unique for each client;<li>Easy revocation of the digital certificate, as the regeneration of the configuration is for only one client, without impacting the others.</ol></ul><p>Thus, the technical procedure for generating new clients will always be the same, just change the client name in the following commands.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~/openvpn-ca# ./easyrsa build-client-full cliente1 nopass
</pre></table></code></div></div><p>This process generated 2 files <code class="language-plaintext highlighter-rouge">~/openvpn-ca/pki/issued/cliente1.crt</code> and <code class="language-plaintext highlighter-rouge">~/openvpn-ca/pki/private/cliente1.key</code>. These two files will be used later when creating the OpenVPN client configuration file.</p><h2 id="configuring-the-openvpn-service"><span class="me-2">Configuring the OpenVPN Service</span><a href="#configuring-the-openvpn-service" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Finally, we can start configuring the OpenVPN service using the credentials and files we generated.</p><h3 id="copying-files-to-the-openvpn-directory"><span class="me-2">Copying Files to the OpenVPN Directory</span><a href="#copying-files-to-the-openvpn-directory" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To start, we need to copy the necessary files to the configuration directory <code class="language-plaintext highlighter-rouge">/etc/openvpn</code>.</p><p>We can begin with all the files we just generated. They were placed inside the <code class="language-plaintext highlighter-rouge">~/openvpn-ca/pki/</code> directory when they were created. We need to copy the certificate and key from our CA, the certificate and key from our server, the HMAC signature, and the Diffie-Hellman file.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# <span class="nb">cd</span> ~/openvpn-ca/pki
root@M4v3r1ck:~/openvpn-ca/pki# <span class="nb">cp </span>ca.crt private/ca.key issued/server.crt private/server.key private/ta.key dh.pem /etc/openvpn
</pre></table></code></div></div><h3 id="openvpn-server-configuration"><span class="me-2">OpenVPN Server Configuration</span><a href="#openvpn-server-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Now that our files are in place, we can create the server configuration file. Create the file <code class="language-plaintext highlighter-rouge">/etc/openvpn/server.conf</code> with the following content:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre><td class="rouge-code"><pre><span class="c">## General Settings</span>
port 4321
proto udp
dev tun
sndbuf 0
rcvbuf 0
topology subnet
duplicate-cn
status-version 2
keepalive 10 120
persist-key
persist-tun
verb 3
comp-lzo no

<span class="c">## Keys</span>
ca ca.crt
cert server.crt
key server.key
dh dh.pem
tls-auth ta.key 0

<span class="c">## Network</span>
server 192.168.50.0 255.255.255.0
ifconfig-pool-persist ipp_server.txt
<span class="c">#push "redirect-gateway def1 bypass-dhcp" # Optional to route all network traffic through VPN</span>
<span class="c">#push "route 192.168.1.0 255.255.252.0" # Additional routes</span>

<span class="c">## Authentication</span>
cipher AES-128-CBC
ncp-ciphers AES-256-GCM:AES-128-GCM
auth SHA1
user nobody
group nogroup
client-to-client
username-as-common-name

<span class="c">## User/pass auth from mysql</span>
plugin /usr/lib/openvpn/openvpn-auth-pam.so openvpn

<span class="c">## Connect-disconnect script (optional)</span>
script-security 2
client-connect /etc/openvpn/connected.py
client-disconnect /etc/openvpn/disconnected.py

<span class="c">## Specific client configurations (optional)</span>
<span class="c">#client-config-dir /etc/openvpn/static_clients_server</span>

<span class="c">## Connected users status file (optional)</span>
status openvpn-status.log
</pre></table></code></div></div><p>Make sure to check the location of the <code class="language-plaintext highlighter-rouge">openvpn-auth-pam.so</code> plugin to ensure that the path specified in the configuration above is correct.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# find / <span class="nt">-name</span> <span class="s2">"*pam*"</span> | <span class="nb">grep</span> <span class="nt">-ioE</span> <span class="s2">".*openvpn.*so"</span>
</pre></table></code></div></div><p>In my environment, the file was located at <code class="language-plaintext highlighter-rouge">/usr/lib/x86_64-linux-gnu/openvpn/plugins/openvpn-plugin-auth-pam.so</code>. Therefore, let’s create a symbolic link to the configuration location.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# <span class="nb">mkdir</span> /usr/lib/openvpn/
root@M4v3r1ck:~# <span class="nb">ln</span> <span class="nt">-s</span> /usr/lib/x86_64-linux-gnu/openvpn/plugins/openvpn-plugin-auth-pam.so /usr/lib/openvpn/openvpn-auth-pam.so
</pre></table></code></div></div><h2 id="creating-the-database-and-configuring-the-pam-connector-for-mysql"><span class="me-2">Creating the Database and Configuring the PAM Connector for MySQL</span><a href="#creating-the-database-and-configuring-the-pam-connector-for-mysql" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To allow the PAM module to connect and authenticate users, you need to create the database where users and passwords will be stored, as well as a connector configuration file. Follow these steps to create the database:</p><ol><li>Log in to MySQL as the root user:</ol><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# mysql <span class="nt">-u</span> root
</pre></table></code></div></div><ol><li>Create the “openvpn” database and user:</ol><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>CREATE DATABASE openvpn<span class="p">;</span>
USE openvpn<span class="p">;</span>

CREATE USER <span class="s1">'openvpn'</span>@<span class="s1">'localhost'</span> IDENTIFIED BY <span class="s1">'MySuperSecurePassword'</span><span class="p">;</span>
GRANT ALL PRIVILEGES ON <span class="sb">`</span>openvpn<span class="sb">`</span>.<span class="k">*</span> TO <span class="s1">'openvpn'</span>@<span class="s1">'localhost'</span><span class="p">;</span>
FLUSH PRIVILEGES<span class="p">;</span>
</pre></table></code></div></div><ol><li>Create the “users” and “log” tables within the “openvpn” database by running the following SQL script:</ol><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre>CREATE TABLE IF NOT EXISTS <span class="sb">`</span><span class="nb">users</span><span class="sb">`</span> <span class="o">(</span>
    <span class="sb">`</span>user_id<span class="sb">`</span> varchar<span class="o">(</span>32<span class="o">)</span> COLLATE utf8_unicode_ci NOT NULL,
    <span class="sb">`</span>user_pass<span class="sb">`</span> varchar<span class="o">(</span>32<span class="o">)</span> COLLATE utf8_unicode_ci NOT NULL,
    <span class="sb">`</span>user_mail<span class="sb">`</span> varchar<span class="o">(</span>64<span class="o">)</span> COLLATE utf8_unicode_ci DEFAULT NULL,
    <span class="sb">`</span>user_start_date<span class="sb">`</span> <span class="nb">date </span>NOT NULL,
    <span class="sb">`</span>user_end_date<span class="sb">`</span> <span class="nb">date </span>NOT NULL,
    <span class="sb">`</span>user_online<span class="sb">`</span> enum<span class="o">(</span><span class="s1">'yes'</span>,<span class="s1">'no'</span><span class="o">)</span> NOT NULL DEFAULT <span class="s1">'no'</span>,
    <span class="sb">`</span>user_enable<span class="sb">`</span> enum<span class="o">(</span><span class="s1">'yes'</span>,<span class="s1">'no'</span><span class="o">)</span> NOT NULL DEFAULT <span class="s1">'yes'</span>,
PRIMARY KEY <span class="o">(</span><span class="sb">`</span>user_id<span class="sb">`</span><span class="o">)</span>,
KEY <span class="sb">`</span>user_pass<span class="sb">`</span> <span class="o">(</span><span class="sb">`</span>user_pass<span class="sb">`</span><span class="o">)</span>
<span class="o">)</span> <span class="nv">ENGINE</span><span class="o">=</span>MyISAM DEFAULT <span class="nv">CHARSET</span><span class="o">=</span>utf8 <span class="nv">COLLATE</span><span class="o">=</span>utf8_unicode_ci<span class="p">;</span>

CREATE TABLE IF NOT EXISTS <span class="sb">`</span>log<span class="sb">`</span> <span class="o">(</span>
    <span class="sb">`</span>log_id<span class="sb">`</span> int<span class="o">(</span>10<span class="o">)</span> unsigned NOT NULL AUTO_INCREMENT,
    <span class="sb">`</span>user_id<span class="sb">`</span> varchar<span class="o">(</span>32<span class="o">)</span> COLLATE utf8_unicode_ci NOT NULL,
    <span class="sb">`</span>log_trusted_ip<span class="sb">`</span> varchar<span class="o">(</span>32<span class="o">)</span> COLLATE utf8_unicode_ci DEFAULT NULL,
    <span class="sb">`</span>log_trusted_port<span class="sb">`</span> varchar<span class="o">(</span>16<span class="o">)</span> COLLATE utf8_unicode_ci DEFAULT NULL,
    <span class="sb">`</span>log_remote_ip<span class="sb">`</span> varchar<span class="o">(</span>32<span class="o">)</span> COLLATE utf8_unicode_ci DEFAULT NULL,
    <span class="sb">`</span>log_remote_port<span class="sb">`</span> varchar<span class="o">(</span>16<span class="o">)</span> COLLATE utf8_unicode_ci DEFAULT NULL,
    <span class="sb">`</span>log_start_time<span class="sb">`</span> timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
    <span class="sb">`</span>log_end_time<span class="sb">`</span> timestamp NULL,
    <span class="sb">`</span>log_received<span class="sb">`</span> float NOT NULL DEFAULT <span class="s1">'0'</span>,
    <span class="sb">`</span>log_send<span class="sb">`</span> float NOT NULL DEFAULT <span class="s1">'0'</span>,
PRIMARY KEY <span class="o">(</span><span class="sb">`</span>log_id<span class="sb">`</span><span class="o">)</span>,
KEY <span class="sb">`</span>user_id<span class="sb">`</span> <span class="o">(</span><span class="sb">`</span>user_id<span class="sb">`</span><span class="o">)</span>
<span class="o">)</span> <span class="nv">ENGINE</span><span class="o">=</span>MyISAM  DEFAULT <span class="nv">CHARSET</span><span class="o">=</span>utf8 <span class="nv">COLLATE</span><span class="o">=</span>utf8_unicode_ci<span class="p">;</span>
</pre></table></code></div></div><p>If you wish to create a test user, execute the following commands:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# mysql <span class="nt">-u</span> root
mysql&gt; use openvpn<span class="p">;</span>
Database changed
mysql&gt; INSERT INTO <span class="nb">users</span> <span class="o">(</span>user_id, user_pass, user_start_date, user_end_date<span class="o">)</span> VALUES <span class="o">(</span><span class="s1">'helvio_junior'</span>,<span class="s1">'@Pass123'</span>, <span class="s1">'2020-05-27'</span>, <span class="s1">'2021-05-27'</span><span class="o">)</span><span class="p">;</span>
Query OK, 1 row affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</pre></table></code></div></div><ol><li>Create the PAM configuration file <code class="language-plaintext highlighter-rouge">/etc/pam.d/openvpn</code> with the following content:</ol><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>auth sufficient pam_mysql.so <span class="nv">user</span><span class="o">=</span>openvpn <span class="nv">passwd</span><span class="o">=</span>MySuperSecurePassword <span class="nv">host</span><span class="o">=</span>localhost <span class="nv">db</span><span class="o">=</span>openvpn <span class="o">[</span><span class="nv">table</span><span class="o">=</span><span class="nb">users</span><span class="o">]</span> <span class="nv">usercolumn</span><span class="o">=</span>users.user_id <span class="nv">passwdcolumn</span><span class="o">=</span>users.user_pass <span class="o">[</span><span class="nv">where</span><span class="o">=</span>users.user_enable<span class="o">=</span>1 AND users.user_start_date!<span class="o">=</span>users.user_end_date AND TO_DAYS<span class="o">(</span>now<span class="o">())</span> <span class="o">&gt;=</span> TO_DAYS<span class="o">(</span>users.user_start_date<span class="o">)</span> AND <span class="o">(</span>TO_DAYS<span class="o">(</span>now<span class="o">())</span> &lt;<span class="o">=</span> TO_DAYS<span class="o">(</span>users.user_end_date<span class="o">))]</span> <span class="nv">sqllog</span><span class="o">=</span>0 <span class="nv">crypt</span><span class="o">=</span>0

account required pam_mysql.so <span class="nv">user</span><span class="o">=</span>openvpn <span class="nv">passwd</span><span class="o">=</span>MySuperSecurePassword <span class="nv">host</span><span class="o">=</span>localhost <span class="nv">db</span><span class="o">=</span>openvpn <span class="o">[</span><span class="nv">table</span><span class="o">=</span><span class="nb">users</span><span class="o">]</span> <span class="nv">usercolumn</span><span class="o">=</span>users.user_id <span class="nv">passwdcolumn</span><span class="o">=</span>users.user_pass <span class="o">[</span><span class="nv">where</span><span class="o">=</span>users.user_enable<span class="o">=</span>1 AND users.user_start_date!<span class="o">=</span>users.user_end_date AND TO_DAYS<span class="o">(</span>now<span class="o">())</span> <span class="o">&gt;=</span> TO_DAYS<span class="o">(</span>users.user_start_date<span class="o">)</span> AND <span class="o">(</span>TO_DAYS<span class="o">(</span>now<span class="o">())</span> &lt;<span class="o">=</span> TO_DAYS<span class="o">(</span>users.user_end_date<span class="o">))]</span> <span class="nv">sqllog</span><span class="o">=</span>0 <span class="nv">crypt</span><span class="o">=</span>0
</pre></table></code></div></div><p>Make sure to replace <code class="language-plaintext highlighter-rouge">MySuperSecurePassword</code> with the actual password you set for the “openvpn” user in MySQL.</p><p>Sure, here’s the translation:</p><h2 id="status-scripts"><span class="me-2">Status Scripts</span><a href="#status-scripts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We have 2 scripts responsible for updating the user’s status immediately after their connection and disconnection.</p><p>Create the file <code class="language-plaintext highlighter-rouge">/etc/openvpn/connected.py</code> with the following content:</p><div file="/etc/openvpn/connected.py" class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="/etc/openvpn/connected.py"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
</span>
<span class="kn">import</span> <span class="n">MySQLdb</span><span class="p">,</span> <span class="n">posix</span><span class="p">,</span> <span class="n">time</span><span class="p">;</span>
<span class="kn">import</span> <span class="n">logging</span>
<span class="kn">import</span> <span class="n">logging.handlers</span>
<span class="kn">import</span> <span class="n">sys</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">os</span>

<span class="n">my_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="sh">'</span><span class="s">MyLogger</span><span class="sh">'</span><span class="p">)</span>
<span class="n">my_logger</span><span class="p">.</span><span class="nf">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">handlers</span><span class="p">.</span><span class="nc">SysLogHandler</span><span class="p">(</span><span class="n">address</span> <span class="o">=</span> <span class="sh">'</span><span class="s">/dev/log</span><span class="sh">'</span><span class="p">)</span>

<span class="n">my_logger</span><span class="p">.</span><span class="nf">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

<span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="n">ts</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
<span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="nf">fromtimestamp</span><span class="p">(</span><span class="n">ts</span><span class="p">).</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">'</span><span class="s">%Y-%m-%d %H:%M:%S</span><span class="sh">'</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">db</span><span class="o">=</span><span class="n">MySQLdb</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="sh">"</span><span class="s">localhost</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">user</span><span class="o">=</span><span class="sh">"</span><span class="s">openvpn</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">passwd</span><span class="o">=</span><span class="sh">"</span><span class="s">MySuperSecurePassword</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">db</span><span class="o">=</span><span class="sh">"</span><span class="s">openvpn</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">posix</span><span class="p">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="n">my_logger</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="sh">"</span><span class="s">%s =&gt; %s</span><span class="sh">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">posix</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)))</span>

    <span class="n">c</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">UPDATE users SET user_online = </span><span class="sh">'</span><span class="s">yes</span><span class="sh">'</span><span class="s"> WHERE user_id = %s</span><span class="sh">"</span><span class="p">,(</span><span class="n">posix</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sa">b</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">].</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">),))</span>
    <span class="n">c</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">INSERT INTO log (user_id, log_trusted_ip, log_trusted_port, log_remote_ip, log_remote_port) VALUES (%s, %s, %s, %s, %s)</span><span class="sh">"</span><span class="p">,(</span><span class="n">posix</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sa">b</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">].</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">),</span><span class="n">posix</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sa">b</span><span class="sh">'</span><span class="s">trusted_ip</span><span class="sh">'</span><span class="p">].</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">),</span><span class="n">posix</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sa">b</span><span class="sh">'</span><span class="s">trusted_port</span><span class="sh">'</span><span class="p">].</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">),</span><span class="n">posix</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sa">b</span><span class="sh">'</span><span class="s">ifconfig_pool_remote_ip</span><span class="sh">'</span><span class="p">].</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">),</span><span class="n">posix</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sa">b</span><span class="sh">'</span><span class="s">remote_port_1</span><span class="sh">'</span><span class="p">].</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">),))</span>

    <span class="n">db</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>

<span class="k">except</span> <span class="n">MySQLdb</span><span class="p">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">my_logger</span><span class="p">.</span><span class="nf">critical</span><span class="p">(</span><span class="sh">"</span><span class="s">MySQL Error [%d]: %s</span><span class="sh">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="p">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">except</span> <span class="nb">IndexError</span><span class="p">:</span>
            <span class="n">my_logger</span><span class="p">.</span><span class="nf">critical</span><span class="p">(</span><span class="sh">"</span><span class="s">MySQL Error: %s</span><span class="sh">"</span> <span class="o">%</span> <span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<span class="k">except</span> <span class="nb">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">my_logger</span><span class="p">.</span><span class="nf">critical</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">my_logger</span><span class="p">.</span><span class="nf">critical</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">my_logger</span><span class="p">.</span><span class="nf">critical</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="n">my_logger</span><span class="p">.</span><span class="nf">critical</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="nf">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
</pre></table></code></div></div><p>Also, create the file <code class="language-plaintext highlighter-rouge">/etc/openvpn/disconnected.py</code> with the following content:</p><div file="/etc/openvpn/disconnected.py" class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="/etc/openvpn/disconnected.py"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">import</span> <span class="n">MySQLdb</span><span class="p">,</span> <span class="n">posix</span><span class="p">,</span> <span class="n">time</span><span class="p">;</span>
<span class="kn">import</span> <span class="n">logging</span>
<span class="kn">import</span> <span class="n">logging.handlers</span>
<span class="kn">import</span> <span class="n">sys</span><span class="p">,</span> <span class="n">datetime</span>

<span class="n">my_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="sh">'</span><span class="s">MyLogger</span><span class="sh">'</span><span class="p">)</span>
<span class="n">my_logger</span><span class="p">.</span><span class="nf">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">handlers</span><span class="p">.</span><span class="nc">SysLogHandler</span><span class="p">(</span><span class="n">address</span> <span class="o">=</span> <span class="sh">'</span><span class="s">/dev/log</span><span class="sh">'</span><span class="p">)</span>

<span class="n">my_logger</span><span class="p">.</span><span class="nf">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

<span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="n">time</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
<span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="nf">fromtimestamp</span><span class="p">(</span><span class="n">time</span><span class="p">).</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">'</span><span class="s">%Y-%m-%d %H:%M:%S</span><span class="sh">'</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
        <span class="n">db</span><span class="o">=</span><span class="n">MySQLdb</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="sh">"</span><span class="s">localhost</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">user</span><span class="o">=</span><span class="sh">"</span><span class="s">openvpn</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">passwd</span><span class="o">=</span><span class="sh">"</span><span class="s">MySuperSecurePassword</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">db</span><span class="o">=</span><span class="sh">"</span><span class="s">openvpn</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">posix</span><span class="p">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="n">my_logger</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="sh">"</span><span class="s">%s =&gt; %s</span><span class="sh">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">posix</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)))</span>

        <span class="n">c</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">UPDATE users SET user_online = </span><span class="sh">'</span><span class="s">no</span><span class="sh">'</span><span class="s"> WHERE user_id = %s</span><span class="sh">"</span><span class="p">,(</span><span class="n">posix</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sa">b</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">].</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">),))</span>

        <span class="n">c</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">UPDATE log set log_end_time = CURRENT_TIMESTAMP, log_send = %s, log_received = %s WHERE log_end_time is null and user_id = %s and log_trusted_ip = %s and log_trusted_port = %s</span><span class="sh">"</span><span class="p">,(</span><span class="n">posix</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sa">b</span><span class="sh">'</span><span class="s">bytes_sent</span><span class="sh">'</span><span class="p">],</span><span class="n">posix</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sa">b</span><span class="sh">'</span><span class="s">bytes_received</span><span class="sh">'</span><span class="p">],</span><span class="n">posix</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sa">b</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">].</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">),</span><span class="n">posix</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sa">b</span><span class="sh">'</span><span class="s">trusted_ip</span><span class="sh">'</span><span class="p">].</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">),</span><span class="n">posix</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sa">b</span><span class="sh">'</span><span class="s">trusted_port</span><span class="sh">'</span><span class="p">].</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">),))</span>

        <span class="n">db</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>

<span class="k">except</span> <span class="n">MySQLdb</span><span class="p">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">my_logger</span><span class="p">.</span><span class="nf">critical</span><span class="p">(</span><span class="sh">"</span><span class="s">MySQL Error [%d]: %s</span><span class="sh">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="p">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">except</span> <span class="nb">IndexError</span><span class="p">:</span>
            <span class="n">my_logger</span><span class="p">.</span><span class="nf">critical</span><span class="p">(</span><span class="sh">"</span><span class="s">MySQL Error: %s</span><span class="sh">"</span> <span class="o">%</span> <span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<span class="k">except</span> <span class="nb">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">my_logger</span><span class="p">.</span><span class="nf">critical</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">my_logger</span><span class="p">.</span><span class="nf">critical</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">my_logger</span><span class="p">.</span><span class="nf">critical</span><span class="p">(</span><span class="sh">'</span><span class="s">Error: %s</span><span class="sh">'</span> <span class="o">%</span> <span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="n">my_logger</span><span class="p">.</span><span class="nf">critical</span><span class="p">(</span><span class="sh">'</span><span class="s">Full stack trace below</span><span class="sh">'</span><span class="p">)</span>
    <span class="kn">from</span> <span class="n">traceback</span> <span class="kn">import</span> <span class="n">format_exc</span>
    <span class="n">err</span> <span class="o">=</span> <span class="nf">format_exc</span><span class="p">().</span><span class="nf">strip</span><span class="p">()</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">err</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">  File</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">File</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">err</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">  Exception: </span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Exception: </span><span class="sh">'</span><span class="p">)</span>
    <span class="n">my_logger</span><span class="p">.</span><span class="nf">critical</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
</pre></table></code></div></div><p>Finally, adjust the permissions of the 2 files:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# <span class="nb">cd</span> /etc/openvpn/
root@M4v3r1ck:~# <span class="nb">chmod</span> +x <span class="k">*</span>.py
</pre></table></code></div></div><h2 id="adjusting-network-configuration"><span class="me-2">Adjusting Network Configuration</span><a href="#adjusting-network-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Next, we need to adjust some aspects of the server’s network configuration so that OpenVPN can route traffic correctly.</p><h3 id="allow-ip-forwarding"><span class="me-2">Allow IP Forwarding</span><a href="#allow-ip-forwarding" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>First, we need to allow the server to forward traffic. This is essential for the functionality we want our VPN server to provide.</p><p>We can adjust this configuration by modifying the <code class="language-plaintext highlighter-rouge">/etc/sysctl.conf</code> file. Inside it, look for the line that defines <code class="language-plaintext highlighter-rouge">net.ipv4.ip_forward</code>. Remove the <code class="language-plaintext highlighter-rouge">#</code> character at the beginning of the line to uncomment/enable this configuration, making it look like the following:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>...
net.ipv4.ip_forward<span class="o">=</span>1
...
</pre></table></code></div></div><p>Save and close the file when you’re done.</p><p>To read the file and adjust the values for the current session, type:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# <span class="nb">sudo </span>sysctl <span class="nt">-p</span>
</pre></table></code></div></div><h3 id="firewall-rules"><span class="me-2">Firewall Rules</span><a href="#firewall-rules" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Now we need to adjust our firewall rules to allow only the desired traffic from the tunnel.</p><p>But before opening the configuration file, we need to identify the name of our network interface. To do this, execute the following command:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# ip route | <span class="nb">grep </span>default
</pre></table></code></div></div><p>You will get a result similar to the one below, where in my environment, the name of my public network interface is ens33. Typically, it’s the name that appears between the “dev” text and the “proto” text:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# default via 192.168.255.2 dev ens33 proto dhcp src 192.168.255.81 metric 100
</pre></table></code></div></div><p>Edit/create the Iptables configuration file <code class="language-plaintext highlighter-rouge">/etc/iptables/rules.v4</code> with the following content:</p><div file="/etc/iptables/rules.v4" class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="/etc/iptables/rules.v4"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="c"># Generated by Helvio Junior M4v3r1ck</span>
<span class="k">*</span>mangle
:PREROUTING ACCEPT <span class="o">[</span>89:22829]
:INPUT ACCEPT <span class="o">[</span>89:22829]
:FORWARD ACCEPT <span class="o">[</span>0:0]
:OUTPUT ACCEPT <span class="o">[</span>88:24171]
:POSTROUTING ACCEPT <span class="o">[</span>88:24171]
COMMIT
<span class="c">#</span>
<span class="k">*</span>nat
:PREROUTING ACCEPT <span class="o">[</span>0:0]
:INPUT ACCEPT <span class="o">[</span>0:0]
:OUTPUT ACCEPT <span class="o">[</span>15:1119]
:POSTROUTING ACCEPT <span class="o">[</span>15:1119]
<span class="nt">-A</span> POSTROUTING <span class="nt">-o</span> ens33 <span class="nt">-j</span> MASQUERADE
COMMIT
<span class="c">#</span>
<span class="k">*</span>filter
:INPUT DROP <span class="o">[</span>0:0]
:FORWARD DROP <span class="o">[</span>0:0]
:OUTPUT ACCEPT <span class="o">[</span>0:0]
<span class="nt">-A</span> INPUT <span class="nt">-m</span> state <span class="nt">--state</span> RELATED,ESTABLISHED <span class="nt">-j</span> ACCEPT
<span class="nt">-A</span> INPUT <span class="nt">-i</span> lo <span class="nt">-j</span> ACCEPT
<span class="nt">-A</span> INPUT <span class="nt">-p</span> udp <span class="nt">-m</span> udp <span class="nt">--sport</span> 1024:65535 <span class="nt">--dport</span> 4321 <span class="nt">-j</span> ACCEPT
<span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">-m</span> tcp <span class="nt">--sport</span> 1024:65535 <span class="nt">--dport</span> 22 <span class="nt">-j</span> ACCEPT
<span class="nt">-A</span> FORWARD <span class="nt">-m</span> state <span class="nt">--state</span> RELATED,ESTABLISHED <span class="nt">-j</span> ACCEPT
<span class="nt">-A</span> FORWARD <span class="nt">-d</span> 192.168.50.0/24 <span class="nt">-i</span> tun+ <span class="nt">-j</span> DROP
<span class="nt">-A</span> FORWARD <span class="nt">-d</span> 192.168.1.0/24 <span class="nt">-i</span> tun+ <span class="nt">-j</span> ACCEPT
<span class="nt">-A</span> FORWARD <span class="nt">-i</span> tun+ <span class="nt">-j</span> DROP
<span class="nt">-A</span> OUTPUT <span class="nt">-m</span> state <span class="nt">--state</span> NEW,RELATED,ESTABLISHED <span class="nt">-j</span> ACCEPT
COMMIT
</pre></table></code></div></div><p>Save the Iptables configuration file and load it into the system with the following command:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# iptables-restore &lt; /etc/iptables/rules.v4
</pre></table></code></div></div><h2 id="enabling-and-starting-openvpn"><span class="me-2">Enabling and Starting OpenVPN</span><a href="#enabling-and-starting-openvpn" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We are finally ready to start the OpenVPN service on our server. We can do this using systemd.</p><p>We need to start the OpenVPN server by specifying the name of our configuration file as an instance variable after the systemd unit file name. Our configuration file for the server is named <code class="language-plaintext highlighter-rouge">/etc/openvpn/server.conf</code>, so we will append <code class="language-plaintext highlighter-rouge">@server</code> to the end of our unit file when calling it:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# systemctl <span class="nb">enable </span>openvpn@server
root@M4v3r1ck:~# systemctl start openvpn@server
</pre></table></code></div></div><p>To check again if the service started successfully, type:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# systemctl status openvpn@server
</pre></table></code></div></div><p>If everything went well, your output should look something like this:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>● openvpn@server.service - OpenVPN connection to server
     Loaded: loaded <span class="o">(</span>/lib/systemd/system/openvpn@.service<span class="p">;</span> enabled<span class="p">;</span> vendor preset: enabled<span class="o">)</span>
     Active: active <span class="o">(</span>running<span class="o">)</span> since Tue 2020-06-23 01:46:46 UTC<span class="p">;</span> 2min 

14s ago
       Docs: man:openvpn<span class="o">(</span>8<span class="o">)</span>
             https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage
             https://community.openvpn.net/openvpn/wiki/HOWTO
   Main PID: 1395 <span class="o">(</span>openvpn<span class="o">)</span>
     Status: <span class="s2">"Initialization Sequence Completed"</span>
      Tasks: 2 <span class="o">(</span>limit: 2266<span class="o">)</span>
     Memory: 1.6M
     CGroup: /system.slice/system-openvpn.slice/openvpn@server.service
             ├─1395 /usr/sbin/openvpn <span class="nt">--daemon</span> ovpn-server <span class="nt">--status</span> /run/openvpn/server.status 10 <span class="nt">--cd</span> /etc/openvpn <span class="nt">--script-security</span> 2 <span class="nt">--config</span> /etc/openvpn/server.conf <span class="nt">--writepid</span> /run/openvpn/server.pid
             └─1403 /usr/sbin/openvpn <span class="nt">--daemon</span> ovpn-server <span class="nt">--status</span> /run/openvpn/server.status 10 <span class="nt">--cd</span> /etc/openvpn <span class="nt">--script-security</span> 2 <span class="nt">--config</span> /etc/openvpn/server.conf <span class="nt">--writepid</span> /run/openvpn/server.pid
</pre></table></code></div></div><p>You can also check that the OpenVPN tun0 interface is available by typing:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# ip addr show tun0
</pre></table></code></div></div><p>You should see a configured interface:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>4: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 100
    <span class="nb">link</span>/none
    inet 192.168.50.1/24 brd 192.168.50.255 scope global tun0
       valid_lft forever preferred_lft forever
    inet6 fe80::c80f:a8ef:a4ea:f460/64 scope <span class="nb">link </span>stable-privacy
       valid_lft forever preferred_lft forever
</pre></table></code></div></div><h2 id="creating-client-configuration-infrastructure"><span class="me-2">Creating Client Configuration Infrastructure</span><a href="#creating-client-configuration-infrastructure" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Next, we need to set up a system that will allow us to easily create client configuration files.</p><h3 id="creating-the-client-configuration-directory-structure"><span class="me-2">Creating the Client Configuration Directory Structure</span><a href="#creating-the-client-configuration-directory-structure" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Create a directory structure inside your home directory to store the files:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# <span class="nb">mkdir</span> <span class="nt">-p</span> ~/client-configs/files
</pre></table></code></div></div><p>Since our client configuration files will have embedded client keys, we should lock down permissions on our inner directory:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# <span class="nb">chmod </span>700 ~/client-configs/files
</pre></table></code></div></div><h3 id="creating-a-basic-configuration"><span class="me-2">Creating a Basic Configuration</span><a href="#creating-a-basic-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Next, let’s copy an example client configuration to our directory to use as our base configuration named <code class="language-plaintext highlighter-rouge">~/client-configs/base.conf</code> with the following content:</p><div file="base.conf" class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="base.conf"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>dev tun
persist-tun
persist-key
cipher AES-128-CBC
ncp-ciphers AES-256-GCM:AES-128-GCM
auth SHA1
tls-client
client
resolv-retry infinite
remote 10.10.10.10 4321 udp
verify-x509-name <span class="s2">"server"</span> name
auth-user-pass
remote-cert-tls server
comp-lzo no
key-direction 1
</pre></table></code></div></div><blockquote class="prompt-warning"><p>Change the IP address in the <code class="language-plaintext highlighter-rouge">remote</code> line from 10.10.10.10 to the external IP address of your server, and replace “server” in the <code class="language-plaintext highlighter-rouge">verify-x509-name</code> line with the name of your server’s digital certificate if it’s different.</p></blockquote><h3 id="creating-a-configuration-generation-script"><span class="me-2">Creating a Configuration Generation Script</span><a href="#creating-a-configuration-generation-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Next, let’s create a simple script to compile our basic configuration with the relevant certificate, key, and encryption files. It will place the generated configuration files in the <code class="language-plaintext highlighter-rouge">~/client-configs/files</code> directory.</p><p>Create and open a file named <code class="language-plaintext highlighter-rouge">make_config.sh</code> inside the <code class="language-plaintext highlighter-rouge">~/client-configs</code> directory with the following content:</p><div file="make_config.sh" class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="make_config.sh"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>
<span class="c"># First argument: Client identifier</span>

<span class="nv">KEY_DIR</span><span class="o">=</span>~/openvpn-ca/pki
<span class="nv">OUTPUT_DIR</span><span class="o">=</span>~/client-configs/files
<span class="nv">BASE_CONFIG</span><span class="o">=</span>~/client-configs/base.conf

<span class="nb">cat</span> <span class="k">${</span><span class="nv">BASE_CONFIG</span><span class="k">}</span> <span class="se">\</span>
    &lt;<span class="o">(</span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s1">'\n&lt;ca&gt;'</span><span class="o">)</span> <span class="se">\</span>
    <span class="k">${</span><span class="nv">KEY_DIR</span><span class="k">}</span>/ca.crt <span class="se">\</span>
    &lt;<span class="o">(</span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s1">'&lt;/ca&gt;\n&lt;cert&gt;'</span><span class="o">)</span> <span class="se">\</span>
    <span class="k">${</span><span class="nv">KEY_DIR</span><span class="k">}</span>/issued/<span class="k">${</span><span class="nv">1</span><span class="k">}</span>.crt <span class="se">\</span>
    &lt;<span class="o">(</span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s1">'&lt;/cert&gt;\n&lt;key&gt;'</span><span class="o">)</span> <span class="se">\</span>
    <span class="k">${</span><span class="nv">KEY_DIR</span><span class="k">}</span>/private/<span class="k">${</span><span class="nv">1</span><span class="k">}</span>.key <span class="se">\</span>
    &lt;<span class="o">(</span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s1">'&lt;/key&gt;\n&lt;tls-auth&gt;'</span><span class="o">)</span> <span class="se">\</span>
    <span class="k">${</span><span class="nv">KEY_DIR</span><span class="k">}</span>/private/ta.key <span class="se">\</span>
    &lt;<span class="o">(</span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s1">'&lt;/tls-auth&gt;'</span><span class="o">)</span> <span class="se">\</span>
    <span class="o">&gt;</span> <span class="k">${</span><span class="nv">OUTPUT_DIR</span><span class="k">}</span>/<span class="k">${</span><span class="nv">1</span><span class="k">}</span>.ovpn
</pre></table></code></div></div><p>Save and close the file when you’re done.</p><p>Make the file executable by typing:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# <span class="nb">chmod </span>700 ~/client-configs/make_config.sh
</pre></table></code></div></div><h2 id="generating-the-client-configuration"><span class="me-2">Generating the Client Configuration</span><a href="#generating-the-client-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now, we can easily generate client configuration files.</p><p>If you followed the guide, you created a client certificate and key named <code class="language-plaintext highlighter-rouge">client1.crt</code> and <code class="language-plaintext highlighter-rouge">client1.key</code>, respectively, by running the <code class="language-plaintext highlighter-rouge">./build-key client1</code> command in the “Creating Client Certificate” step. We can generate a configuration for these credentials by moving them into our <code class="language-plaintext highlighter-rouge">~/client-configs</code> directory and using the script we created:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# <span class="nb">cd</span> ~/client-configs
root@M4v3r1ck:~# ./make_config.sh client1
</pre></table></code></div></div><p>If everything went well, we should have a <code class="language-plaintext highlighter-rouge">client1.ovpn</code> file in our <code class="language-plaintext highlighter-rouge">~/client-configs/files</code> directory:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>root@M4v3r1ck:~# <span class="nb">ls</span> ~/client-configs/files
client1.ovpn
</pre></table></code></div></div><p>There you go! Now you just need to securely send the <code class="language-plaintext highlighter-rouge">client1.ovpn</code> file to your client.</p><p>Sources:</p><ul><li><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-an-openvpn-server-on-ubuntu-16-04">How To Set Up an OpenVPN Server on Ubuntu 16.04</a><li><a href="https://sysadmin.compxtreme.ro/how-to-install-a-openvpn-system-based-on-userpassword-authentication-with-mysql-day-control-libpam-mysql/">How to install a OpenVPN system based on user/password authentication with MySQL day control</a><li><a href="https://github.com/OpenVPN/easy-rsa/blob/master/README.quickstart.md">OpenVPN/easy-rsa README.quickstart.md</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/it/'>IT</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/openvpn/" class="post-tag no-text-decoration" >OpenVPN</a> <a href="/tags/vpn/" class="post-tag no-text-decoration" >VPN</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Installing OpenVPN with MySQL Authentication - Helvio Junior&url=https://www.helviojunior.com.br/en/it/installing-openvpn-with-mysql-authentication/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Installing OpenVPN with MySQL Authentication - Helvio Junior&u=https://www.helviojunior.com.br/en/it/installing-openvpn-with-mysql-authentication/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Installing OpenVPN with MySQL Authentication - Helvio Junior&url=https://www.helviojunior.com.br/en/it/installing-openvpn-with-mysql-authentication/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.helviojunior.com.br/en/it/installing-openvpn-with-mysql-authentication/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/security/osint/localizando-ips-que-respondem-para-uma-url/">Localizando IPs que respondem para uma URL</a><li><a href="/security/osint/locating-url-ips-bypass-waf/">Locating IPs that respond to a URL</a><li><a href="/security/edr/instalando-elasticsearch-edr/">Instalando Elasticsearch EDR</a><li><a href="/it/instalando-openvpn-com-autenticacao-em-mysql/">Instalando OpenVPN com autenticação em MySQL</a><li><a href="/it/osce-osed-e-ecxd-certificacoes-de-desenvolvimento-de-exploits/">OSCE, OSED e eCXD: Certificações de desenvolvimento de Exploits</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/offensive-security/">Offensive Security</a> <a class="post-tag" href="/tags/pentest/">Pentest</a> <a class="post-tag" href="/tags/autoridade-certificadora/">autoridade certificadora</a> <a class="post-tag" href="/tags/ca/">ca</a> <a class="post-tag" href="/tags/certificate-authority/">certificate authority</a> <a class="post-tag" href="/tags/openssl/">openssl</a> <a class="post-tag" href="/tags/osce3/">OSCE3</a> <a class="post-tag" href="/tags/buffer-overflow/">Buffer Overflow</a> <a class="post-tag" href="/tags/osed/">OSED</a> <a class="post-tag" href="/tags/osee/">OSEE</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/it/instalando-openvpn-2-4-x-em-ubuntu-debian/"><div class="card-body"> <span class="timeago small" > May 27, 2020 <i class="unloaded">2020-05-27T16:17:48-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Instalando OpenVPN 2.4.x em Ubuntu/Debian</h3><div class="text-muted small"><p> curl -s https://swupdate.openvpn.net/repos/repo-public.gpg | apt-key add - echo "deb http://build.openvpn.net/debian/openvpn/stable `lsb_release --codename --short` main" &gt; /etc/apt/sources.list...</p></div></div></a></div><div class="card"> <a href="/it/instalando-openvpn-com-autenticacao-em-mysql/"><div class="card-body"> <span class="timeago small" > Jun 22, 2020 <i class="unloaded">2020-06-22T16:38:05-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Instalando OpenVPN com autenticação em MySQL</h3><div class="text-muted small"><p> OpenVPN é um software Linux utilizado para criação de túneis VPN. Neste artigo demonstrarei passo-a-passo como instalar o OpenVPN com os seguintes pré-requisitos: Versão atualizada do próprio r...</p></div></div></a></div><div class="card"> <a href="/it/configurando-802-1q-vlan-tagging/"><div class="card-body"> <span class="timeago small" > Mar 13, 2013 <i class="unloaded">2013-03-13T21:14:35-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Configurando 802.1q VLAN Tagging no linux</h3><div class="text-muted small"><p> 1 - Verifique se o módulo está carregado no kernel [sourcecode language="csharp"]lsmod | grep 8021q[/sourcecode] 2 - Se o módulo não tiver carregado, carregue com o seguinte comando: [sourcecode la...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/it/instalando-openvpn-com-autenticacao-em-mysql/" class="btn btn-outline-primary" prompt="Older"><p>Instalando OpenVPN com autenticação em MySQL</p></a> <a href="/it/oswe-uma-historia-de-insucessos/" class="btn btn-outline-primary" prompt="Newer"><p>OSWE - Uma história de insucessos!</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Installing OpenVPN with MySQL Authentication'; this.page.url = 'https://www.helviojunior.com.br/en/it/installing-openvpn-with-mysql-authentication/'; this.page.identifier = '/en/it/installing-openvpn-with-mysql-authentication/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/helviojunior">Helvio junior (aka M4v3r1ck)</a>. <span data-toggle="tooltip" data-placement="top" title="Some rights reserved.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/offensive-security/">Offensive Security</a> <a class="post-tag" href="/tags/pentest/">Pentest</a> <a class="post-tag" href="/tags/autoridade-certificadora/">autoridade certificadora</a> <a class="post-tag" href="/tags/ca/">ca</a> <a class="post-tag" href="/tags/certificate-authority/">certificate authority</a> <a class="post-tag" href="/tags/openssl/">openssl</a> <a class="post-tag" href="/tags/osce3/">OSCE3</a> <a class="post-tag" href="/tags/buffer-overflow/">Buffer Overflow</a> <a class="post-tag" href="/tags/osed/">OSED</a> <a class="post-tag" href="/tags/osee/">OSEE</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.helviojunior.com.br{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
