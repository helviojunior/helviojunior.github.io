<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Criando repositório único de arquivos para diversos servidores usando NFS" /><meta name="author" content="Helvio Junior (m4v3r1ck)" /><meta property="og:locale" content="en_US" /><meta name="description" content="O objetivo deste post é demonstrar como criar um único repositório de arquivos para acesso através de diversos servidores. Você pode estar se perguntando onde e como devo utilizar isso? Bom, há muitas utilizações mas uma delas, e a motivadora deste estudo e post, e a possibilidade de você armazenar em um único lugar todo o conteúdo do seu site web (/var/www) e poder utilizar por diversos servidores balanceados, ou seja, você poderá ter 10 servidores Web acessando um único /var/www sem ter que se preocupar toda vez que atualizar um arquivo em um servidor ter que replicar para os outros. O que é NFS? Antes de iniciar o processo técnico é importante entender o que é e como funciona o NFS. NFS é um acronimo de Network File System, ou seja, Sistema de arquivos em rede. Basicamente o NFS permite que você monte partições ou diretórios fisicamente armazenados em outra maquina como se fosse local, ou seja, via rede, podendo definir permissões específicas de acesso com base no cliente que está acessando. Instalando e configurando o servidor NFS Para este post utilizei o Linux Ubuntu Server 14.04 LTS, mas este procedimento poderá ser replicado para diversas outras distribuições Linux sem nenhum problema. Chega de conversa e vamos ao que interessa, a instalação do servidor NFS. Primeiro vamos configurar o servidor, ou seja, o local onde os arquivos estarão fisicamente. &nbsp; Utilize o comando abaixo para instalar os pacotes necessários [sourcecode language=&quot;shell&quot;]apt-get install nfs-common nfs-kernel-server [/sourcecode] Crie o diretório que utilizaremos para o compartilhamento com o comando abaixo [sourcecode language=&quot;shell&quot;]mkdir /media/share [/sourcecode] Edite o arquivo /etc/exports deixando o mesmo com o conteúdo abaixo [sourcecode language=&quot;shell&quot;]# Caminho do diretório IP do cliente Permissões de acesso /media/share/ 192.168.0.0/24(rw,async,no_subtree_check) [/sourcecode] O padrão deste arquivo é: Diretório host1(opção11, opção12) host2(opção21, opção22) Onde: Diretório: Local (diretório) onde os arquivos estão armazenados; HostN: IP do cliente que irá acessar os arquivos Opções: Permissões de acesso ao compartilhamento Segue as principais permissões: ro: somente leitura. rw: leitura e escrita. no_root_squash: por default, o nível de acesso dos clientes ao servidor é mesmo que o root. Porém, se quiser que os níveis de acesso sejam os mesmos que os locais, basta definir esta opção no compartilhamento. Agora vamos fazer uma otimização para alto desempenho no NFS. Edite o arquivo /etc/default/nfs-kernel-server e altere as linhas correspondentes conforme exemplo abaixo: [sourcecode language=&quot;shell&quot;]RPCNFSDCOUNT=20 RPCMOUNTDOPTS=&quot;--manage-gids --no-nfs-version 4&quot; [/sourcecode] Como último passo do servidor iniciar o serviço NFS com o comando abaixo [sourcecode language=&quot;shell&quot;]service nfs-kernel-server start [/sourcecode] Caso você adicione um novo ponto de montagem (compartilhamento) no arquivo /etc/exports, para ativa-lo sem reiniciar o serviço do NFS basta executar o comando exportfs. Configurando o cliente NFS Utilize o comando abaixo para instalar os pacotes necessários [sourcecode language=&quot;shell&quot;]apt-get install nfs-common [/sourcecode] Crie o ponto de montagem, ou seja, o diretório virtual onde posteriormente montaremos o diretório remoto com o comando abaixo [sourcecode language=&quot;shell&quot;]mkdir /mnt/remoto [/sourcecode] Caso deseje realizar um teste de montagem do NFS basta utilizar o comando abaixo [sourcecode language=&quot;shell&quot;] mount -t nfs 192.168.0.1:/media/share /mnt/remoto [/sourcecode] Posteriormente basta adicionar no arquivo /etc/fstab as configurações do NFS e ponto de montagem conforme o exemplo abaixo [sourcecode language=&quot;shell&quot;]# Caminho do servidor Ponto de montagem Tipo-FS Opções 192.168.0.1:/media/share /mnt/remoto nfs rw 0 0 [/sourcecode] Adicionalmente vamos realizar algumas otimizações para melhor desempenho no NFS, para isso basta alterar as opções de montagem conforme exemplo abaixo [sourcecode language=&quot;shell&quot;]# Caminho do servidor Ponto de montagem Tipo-FS Opções 192.168.0.1:/media/share /mnt/remoto nfs auto,rw,noatime,bg,soft,intr,rsize=32768,wsize=32768,nfsvers=3,nolock,nocto,tcp 0 0 [/sourcecode] Agora basta montar o diretório remoto com o seguinte comando [sourcecode language=&quot;shell&quot;]mount /mnt/remoto [/sourcecode]" /><meta property="og:description" content="O objetivo deste post é demonstrar como criar um único repositório de arquivos para acesso através de diversos servidores. Você pode estar se perguntando onde e como devo utilizar isso? Bom, há muitas utilizações mas uma delas, e a motivadora deste estudo e post, e a possibilidade de você armazenar em um único lugar todo o conteúdo do seu site web (/var/www) e poder utilizar por diversos servidores balanceados, ou seja, você poderá ter 10 servidores Web acessando um único /var/www sem ter que se preocupar toda vez que atualizar um arquivo em um servidor ter que replicar para os outros. O que é NFS? Antes de iniciar o processo técnico é importante entender o que é e como funciona o NFS. NFS é um acronimo de Network File System, ou seja, Sistema de arquivos em rede. Basicamente o NFS permite que você monte partições ou diretórios fisicamente armazenados em outra maquina como se fosse local, ou seja, via rede, podendo definir permissões específicas de acesso com base no cliente que está acessando. Instalando e configurando o servidor NFS Para este post utilizei o Linux Ubuntu Server 14.04 LTS, mas este procedimento poderá ser replicado para diversas outras distribuições Linux sem nenhum problema. Chega de conversa e vamos ao que interessa, a instalação do servidor NFS. Primeiro vamos configurar o servidor, ou seja, o local onde os arquivos estarão fisicamente. &nbsp; Utilize o comando abaixo para instalar os pacotes necessários [sourcecode language=&quot;shell&quot;]apt-get install nfs-common nfs-kernel-server [/sourcecode] Crie o diretório que utilizaremos para o compartilhamento com o comando abaixo [sourcecode language=&quot;shell&quot;]mkdir /media/share [/sourcecode] Edite o arquivo /etc/exports deixando o mesmo com o conteúdo abaixo [sourcecode language=&quot;shell&quot;]# Caminho do diretório IP do cliente Permissões de acesso /media/share/ 192.168.0.0/24(rw,async,no_subtree_check) [/sourcecode] O padrão deste arquivo é: Diretório host1(opção11, opção12) host2(opção21, opção22) Onde: Diretório: Local (diretório) onde os arquivos estão armazenados; HostN: IP do cliente que irá acessar os arquivos Opções: Permissões de acesso ao compartilhamento Segue as principais permissões: ro: somente leitura. rw: leitura e escrita. no_root_squash: por default, o nível de acesso dos clientes ao servidor é mesmo que o root. Porém, se quiser que os níveis de acesso sejam os mesmos que os locais, basta definir esta opção no compartilhamento. Agora vamos fazer uma otimização para alto desempenho no NFS. Edite o arquivo /etc/default/nfs-kernel-server e altere as linhas correspondentes conforme exemplo abaixo: [sourcecode language=&quot;shell&quot;]RPCNFSDCOUNT=20 RPCMOUNTDOPTS=&quot;--manage-gids --no-nfs-version 4&quot; [/sourcecode] Como último passo do servidor iniciar o serviço NFS com o comando abaixo [sourcecode language=&quot;shell&quot;]service nfs-kernel-server start [/sourcecode] Caso você adicione um novo ponto de montagem (compartilhamento) no arquivo /etc/exports, para ativa-lo sem reiniciar o serviço do NFS basta executar o comando exportfs. Configurando o cliente NFS Utilize o comando abaixo para instalar os pacotes necessários [sourcecode language=&quot;shell&quot;]apt-get install nfs-common [/sourcecode] Crie o ponto de montagem, ou seja, o diretório virtual onde posteriormente montaremos o diretório remoto com o comando abaixo [sourcecode language=&quot;shell&quot;]mkdir /mnt/remoto [/sourcecode] Caso deseje realizar um teste de montagem do NFS basta utilizar o comando abaixo [sourcecode language=&quot;shell&quot;] mount -t nfs 192.168.0.1:/media/share /mnt/remoto [/sourcecode] Posteriormente basta adicionar no arquivo /etc/fstab as configurações do NFS e ponto de montagem conforme o exemplo abaixo [sourcecode language=&quot;shell&quot;]# Caminho do servidor Ponto de montagem Tipo-FS Opções 192.168.0.1:/media/share /mnt/remoto nfs rw 0 0 [/sourcecode] Adicionalmente vamos realizar algumas otimizações para melhor desempenho no NFS, para isso basta alterar as opções de montagem conforme exemplo abaixo [sourcecode language=&quot;shell&quot;]# Caminho do servidor Ponto de montagem Tipo-FS Opções 192.168.0.1:/media/share /mnt/remoto nfs auto,rw,noatime,bg,soft,intr,rsize=32768,wsize=32768,nfsvers=3,nolock,nocto,tcp 0 0 [/sourcecode] Agora basta montar o diretório remoto com o seguinte comando [sourcecode language=&quot;shell&quot;]mount /mnt/remoto [/sourcecode]" /><link rel="canonical" href="https://www.helviojunior.com.br/it/criando-repositorio-unico-de-arquivos-para-diversos-servidores-usando-nfs/" /><meta property="og:url" content="https://www.helviojunior.com.br/it/criando-repositorio-unico-de-arquivos-para-diversos-servidores-usando-nfs/" /><meta property="og:site_name" content="Helvio Junior" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2015-10-14T12:18:47-03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Criando repositório único de arquivos para diversos servidores usando NFS" /><meta name="twitter:site" content="@helvioju" /><meta name="twitter:creator" content="@Helvio Junior (m4v3r1ck)" /><meta name="google-site-verification" content="JR4IIP9jfvOwxn2ybV_Qn0SrtDPlTrKomdPWgBuP55k"" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Helvio Junior (m4v3r1ck)"},"dateModified":"2023-08-16T23:57:56-03:00","datePublished":"2015-10-14T12:18:47-03:00","description":"O objetivo deste post é demonstrar como criar um único repositório de arquivos para acesso através de diversos servidores. Você pode estar se perguntando onde e como devo utilizar isso? Bom, há muitas utilizações mas uma delas, e a motivadora deste estudo e post, e a possibilidade de você armazenar em um único lugar todo o conteúdo do seu site web (/var/www) e poder utilizar por diversos servidores balanceados, ou seja, você poderá ter 10 servidores Web acessando um único /var/www sem ter que se preocupar toda vez que atualizar um arquivo em um servidor ter que replicar para os outros. O que é NFS? Antes de iniciar o processo técnico é importante entender o que é e como funciona o NFS. NFS é um acronimo de Network File System, ou seja, Sistema de arquivos em rede. Basicamente o NFS permite que você monte partições ou diretórios fisicamente armazenados em outra maquina como se fosse local, ou seja, via rede, podendo definir permissões específicas de acesso com base no cliente que está acessando. Instalando e configurando o servidor NFS Para este post utilizei o Linux Ubuntu Server 14.04 LTS, mas este procedimento poderá ser replicado para diversas outras distribuições Linux sem nenhum problema. Chega de conversa e vamos ao que interessa, a instalação do servidor NFS. Primeiro vamos configurar o servidor, ou seja, o local onde os arquivos estarão fisicamente. &nbsp; Utilize o comando abaixo para instalar os pacotes necessários [sourcecode language=&quot;shell&quot;]apt-get install nfs-common nfs-kernel-server [/sourcecode] Crie o diretório que utilizaremos para o compartilhamento com o comando abaixo [sourcecode language=&quot;shell&quot;]mkdir /media/share [/sourcecode] Edite o arquivo /etc/exports deixando o mesmo com o conteúdo abaixo [sourcecode language=&quot;shell&quot;]# Caminho do diretório IP do cliente Permissões de acesso /media/share/ 192.168.0.0/24(rw,async,no_subtree_check) [/sourcecode] O padrão deste arquivo é: Diretório host1(opção11, opção12) host2(opção21, opção22) Onde: Diretório: Local (diretório) onde os arquivos estão armazenados; HostN: IP do cliente que irá acessar os arquivos Opções: Permissões de acesso ao compartilhamento Segue as principais permissões: ro: somente leitura. rw: leitura e escrita. no_root_squash: por default, o nível de acesso dos clientes ao servidor é mesmo que o root. Porém, se quiser que os níveis de acesso sejam os mesmos que os locais, basta definir esta opção no compartilhamento. Agora vamos fazer uma otimização para alto desempenho no NFS. Edite o arquivo /etc/default/nfs-kernel-server e altere as linhas correspondentes conforme exemplo abaixo: [sourcecode language=&quot;shell&quot;]RPCNFSDCOUNT=20 RPCMOUNTDOPTS=&quot;--manage-gids --no-nfs-version 4&quot; [/sourcecode] Como último passo do servidor iniciar o serviço NFS com o comando abaixo [sourcecode language=&quot;shell&quot;]service nfs-kernel-server start [/sourcecode] Caso você adicione um novo ponto de montagem (compartilhamento) no arquivo /etc/exports, para ativa-lo sem reiniciar o serviço do NFS basta executar o comando exportfs. Configurando o cliente NFS Utilize o comando abaixo para instalar os pacotes necessários [sourcecode language=&quot;shell&quot;]apt-get install nfs-common [/sourcecode] Crie o ponto de montagem, ou seja, o diretório virtual onde posteriormente montaremos o diretório remoto com o comando abaixo [sourcecode language=&quot;shell&quot;]mkdir /mnt/remoto [/sourcecode] Caso deseje realizar um teste de montagem do NFS basta utilizar o comando abaixo [sourcecode language=&quot;shell&quot;] mount -t nfs 192.168.0.1:/media/share /mnt/remoto [/sourcecode] Posteriormente basta adicionar no arquivo /etc/fstab as configurações do NFS e ponto de montagem conforme o exemplo abaixo [sourcecode language=&quot;shell&quot;]# Caminho do servidor Ponto de montagem Tipo-FS Opções 192.168.0.1:/media/share /mnt/remoto nfs rw 0 0 [/sourcecode] Adicionalmente vamos realizar algumas otimizações para melhor desempenho no NFS, para isso basta alterar as opções de montagem conforme exemplo abaixo [sourcecode language=&quot;shell&quot;]# Caminho do servidor Ponto de montagem Tipo-FS Opções 192.168.0.1:/media/share /mnt/remoto nfs auto,rw,noatime,bg,soft,intr,rsize=32768,wsize=32768,nfsvers=3,nolock,nocto,tcp 0 0 [/sourcecode] Agora basta montar o diretório remoto com o seguinte comando [sourcecode language=&quot;shell&quot;]mount /mnt/remoto [/sourcecode]","headline":"Criando repositório único de arquivos para diversos servidores usando NFS","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.helviojunior.com.br/it/criando-repositorio-unico-de-arquivos-para-diversos-servidores-usando-nfs/"},"url":"https://www.helviojunior.com.br/it/criando-repositorio-unico-de-arquivos-para-diversos-servidores-usando-nfs/"}</script><title>Criando repositório único de arquivos para diversos servidores usando NFS | Helvio Junior</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Helvio Junior"><meta name="application-name" content="Helvio Junior"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/m4v3r1ck.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Helvio Junior</a></div><div class="site-subtitle font-italic">Cyber security researcher, speaker, low level and binary exploitation entusiast. <br /><br />"I’m just a child who has never grown up. I still keep asking these 'how' & 'why' questions. Occasionally, I find an answer. Stephen Hawking"</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://www.linkedin.com/in/helviojunior" aria-label="linkedin" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.youtube.com/@Sec4US" aria-label="youtube" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="https://github.com/helviojunior" aria-label="github" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['helvio.junior','sec4us.com.br'].join('@')" aria-label="email" class="order-6" > <i class="fas fa-envelope"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/it"> It </a> </span> <span>Criando repositório único de arquivos para diversos servidores usando NFS</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Criando repositório único de arquivos para diversos servidores usando NFS</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Helvio Junior (m4v3r1ck) </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Oct 14, 2015, 12:18 PM -0300" prep="on" > Oct 14, 2015 <i class="unloaded">2015-10-14T12:18:47-03:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Aug 16, 2023, 11:57 PM -0300" prefix="Updated " > Aug 16, 2023 <i class="unloaded">2023-08-16T23:57:56-03:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="583 words">3 min</span></div></div><div class="post-content"><p>O objetivo deste post é demonstrar como criar um único repositório de arquivos para acesso através de diversos servidores. Você pode estar se perguntando onde e como devo utilizar isso? Bom, há muitas utilizações mas uma delas, e a motivadora deste estudo e post, e a possibilidade de você armazenar em um único lugar todo o conteúdo do seu site web (/var/www) e poder utilizar por diversos servidores balanceados, ou seja, você poderá ter 10 servidores Web acessando um único /var/www sem ter que se preocupar toda vez que atualizar um arquivo em um servidor ter que replicar para os outros.</p><p></p><h2>O que é NFS?</h2><p>Antes de iniciar o processo técnico é importante entender o que é e como funciona o NFS. NFS é um acronimo de Network File System, ou seja, Sistema de arquivos em rede. Basicamente o NFS permite que você monte partições ou diretórios fisicamente armazenados em outra maquina como se fosse local, ou seja, via rede, podendo definir permissões específicas de acesso com base no cliente que está acessando.</p><h2>Instalando e configurando o servidor NFS</h2><p>Para este post utilizei o Linux Ubuntu Server 14.04 LTS, mas este procedimento poderá ser replicado para diversas outras distribuições Linux sem nenhum problema. Chega de conversa e vamos ao que interessa, a instalação do servidor NFS.</p><p>Primeiro vamos configurar o servidor, ou seja, o local onde os arquivos estarão fisicamente.</p><p>&nbsp;</p><p>Utilize o comando abaixo para instalar os pacotes necessários</p><p>[sourcecode language="shell"]apt-get install nfs-common nfs-kernel-server<br /> [/sourcecode]</p><p>Crie o diretório que utilizaremos para o compartilhamento com o comando abaixo</p><p>[sourcecode language="shell"]mkdir /media/share<br /> [/sourcecode]</p><p>Edite o arquivo <strong>/etc/exports</strong> deixando o mesmo com o conteúdo abaixo</p><p>[sourcecode language="shell"]# Caminho do diretório IP do cliente Permissões de acesso<br /> /media/share/ 192.168.0.0/24(rw,async,no_subtree_check)<br /> [/sourcecode]</p><p>O padrão deste arquivo é: <i>Diretório host1(opção11, opção12) host2(opção21, opção22)</i></p><p>Onde:</p><ul><li>Diretório: Local (diretório) onde os arquivos estão armazenados;<li>HostN: IP do cliente que irá acessar os arquivos<li>Opções: Permissões de acesso ao compartilhamento</ul><p>Segue as principais permissões:</p><ul><li>ro: somente leitura.<li>rw: leitura e escrita.<li>no_root_squash: por default, o nível de acesso dos clientes ao servidor é mesmo que o root. Porém, se quiser que os níveis de acesso sejam os mesmos que os locais, basta definir esta opção no compartilhamento.</ul><p>Agora vamos fazer uma otimização para alto desempenho no NFS. Edite o arquivo /etc/default/nfs-kernel-server e altere as linhas correspondentes conforme exemplo abaixo:</p><p>[sourcecode language="shell"]RPCNFSDCOUNT=20<br /> RPCMOUNTDOPTS=&quot;--manage-gids --no-nfs-version 4&quot;<br /> [/sourcecode]</p><p>Como último passo do servidor iniciar o serviço NFS com o comando abaixo</p><p>[sourcecode language="shell"]service nfs-kernel-server start<br /> [/sourcecode]</p><p>Caso você adicione um novo ponto de montagem (compartilhamento) no arquivo <strong>/etc/exports</strong>, para ativa-lo sem reiniciar o serviço do NFS basta executar o comando <b>exportfs.</b></p><h2>Configurando o cliente NFS</h2><p>Utilize o comando abaixo para instalar os pacotes necessários</p><p>[sourcecode language="shell"]apt-get install nfs-common<br /> [/sourcecode]</p><p>Crie o ponto de montagem, ou seja, o diretório virtual onde posteriormente montaremos o diretório remoto com o comando abaixo</p><p>[sourcecode language="shell"]mkdir /mnt/remoto<br /> [/sourcecode]</p><p>Caso deseje realizar um teste de montagem do NFS basta utilizar o comando abaixo</p><p>[sourcecode language="shell"]<br /> mount -t nfs 192.168.0.1:/media/share /mnt/remoto<br /> [/sourcecode]</p><p>Posteriormente basta adicionar no arquivo <strong>/etc/fstab</strong> as configurações do NFS e ponto de montagem conforme o exemplo abaixo</p><p>[sourcecode language="shell"]# Caminho do servidor Ponto de montagem Tipo-FS Opções<br /> 192.168.0.1:/media/share /mnt/remoto nfs rw 0 0<br /> [/sourcecode]</p><p>Adicionalmente vamos realizar algumas otimizações para melhor desempenho no NFS, para isso basta alterar as opções de montagem conforme exemplo abaixo</p><p>[sourcecode language="shell"]# Caminho do servidor Ponto de montagem Tipo-FS Opções<br /> 192.168.0.1:/media/share /mnt/remoto nfs auto,rw,noatime,bg,soft,intr,rsize=32768,wsize=32768,nfsvers=3,nolock,nocto,tcp 0 0<br /> [/sourcecode]</p><p>Agora basta montar o diretório remoto com o seguinte comando</p><p>[sourcecode language="shell"]mount /mnt/remoto<br /> [/sourcecode]</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/it/'>IT</a>, <a href='/categories/linux/'>Linux</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Criando repositório único de arquivos para diversos servidores usando NFS - Helvio Junior&url=https://www.helviojunior.com.br/it/criando-repositorio-unico-de-arquivos-para-diversos-servidores-usando-nfs/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Criando repositório único de arquivos para diversos servidores usando NFS - Helvio Junior&u=https://www.helviojunior.com.br/it/criando-repositorio-unico-de-arquivos-para-diversos-servidores-usando-nfs/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Criando repositório único de arquivos para diversos servidores usando NFS - Helvio Junior&url=https://www.helviojunior.com.br/it/criando-repositorio-unico-de-arquivos-para-diversos-servidores-usando-nfs/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.helviojunior.com.br/it/criando-repositorio-unico-de-arquivos-para-diversos-servidores-usando-nfs/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/security/osint/localizando-ips-que-respondem-para-uma-url/">Localizando IPs que respondem para uma URL</a><li><a href="/security/osint/locating-url-ips-bypass-waf/">Locating IPs that respond to a URL</a><li><a href="/security/edr/instalando-elasticsearch-edr/">Instalando Elasticsearch EDR</a><li><a href="/it/instalando-openvpn-com-autenticacao-em-mysql/">Instalando OpenVPN com autenticação em MySQL</a><li><a href="/it/osce-osed-e-ecxd-certificacoes-de-desenvolvimento-de-exploits/">OSCE, OSED e eCXD: Certificações de desenvolvimento de Exploits</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/offensive-security/">Offensive Security</a> <a class="post-tag" href="/tags/pentest/">Pentest</a> <a class="post-tag" href="/tags/autoridade-certificadora/">autoridade certificadora</a> <a class="post-tag" href="/tags/ca/">ca</a> <a class="post-tag" href="/tags/certificate-authority/">certificate authority</a> <a class="post-tag" href="/tags/openssl/">openssl</a> <a class="post-tag" href="/tags/osce3/">OSCE3</a> <a class="post-tag" href="/tags/buffer-overflow/">Buffer Overflow</a> <a class="post-tag" href="/tags/osed/">OSED</a> <a class="post-tag" href="/tags/osee/">OSEE</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/it/backup-com-dd-dd-backup-without-empty-space/"><div class="card-body"> <span class="timeago small" > Jun 28, 2013 <i class="unloaded">2013-06-28T14:43:10-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Backup com dd (dd backup without empty space)</h3><div class="text-muted small"><p> Com a utilização do Raspberry tive a necessidade de preparar uma imagem base para clonar em outros dispositivos ou até mesmo para fins de backup. A melhor ferramenta para realizar essa operação é o...</p></div></div></a></div><div class="card"> <a href="/it/criando-um-nas-network-attached-storage/"><div class="card-body"> <span class="timeago small" > Jul 7, 2014 <i class="unloaded">2014-07-07T21:06:04-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Criando um NAS (Network-Attached Storage) e DLNA</h3><div class="text-muted small"><p> O Objetivo deste post é demonstrar passo a passo como configurar um Raspberry Pi para servir como servidor de arquivos/NAS. Com poucas alterações este mesmo procedimento poderá ser utilizado para c...</p></div></div></a></div><div class="card"> <a href="/it/como-montar-um-volume-linux-lvm-no-linux/"><div class="card-body"> <span class="timeago small" > Aug 6, 2014 <i class="unloaded">2014-08-06T09:04:57-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Como montar um volume Linux LVM no Linux</h3><div class="text-muted small"><p> Em muitos casos é necessário montar um volume LVM em um linux, como um HD externo, por exemplo. Segue o procedimento de identificação e montagem do volume LVM. Listando os discos e partições [sour...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/automotivo/esquema-eletrico-do-som-citroen-peugeot/" class="btn btn-outline-primary" prompt="Older"><p>Esquema elétrico do som Citroen/Peugeot</p></a> <a href="/it/linux/configurando-postfix-para-usar-smtp-do-gmail-no-ubuntu/" class="btn btn-outline-primary" prompt="Newer"><p>Configurando Postfix para usar SMTP do Gmail no Ubuntu</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Criando repositório único de arquivos para diversos servidores usando NFS'; this.page.url = 'https://www.helviojunior.com.br/it/criando-repositorio-unico-de-arquivos-para-diversos-servidores-usando-nfs/'; this.page.identifier = '/it/criando-repositorio-unico-de-arquivos-para-diversos-servidores-usando-nfs/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/helviojunior">Helvio junior (aka M4v3r1ck)</a>. <span data-toggle="tooltip" data-placement="top" title="Some rights reserved.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/offensive-security/">Offensive Security</a> <a class="post-tag" href="/tags/pentest/">Pentest</a> <a class="post-tag" href="/tags/autoridade-certificadora/">autoridade certificadora</a> <a class="post-tag" href="/tags/ca/">ca</a> <a class="post-tag" href="/tags/certificate-authority/">certificate authority</a> <a class="post-tag" href="/tags/openssl/">openssl</a> <a class="post-tag" href="/tags/osce3/">OSCE3</a> <a class="post-tag" href="/tags/buffer-overflow/">Buffer Overflow</a> <a class="post-tag" href="/tags/osed/">OSED</a> <a class="post-tag" href="/tags/osee/">OSEE</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.helviojunior.com.br{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
