<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Criando um servidor de DDNS" /><meta name="author" content="Helvio Junior (m4v3r1ck)" /><meta property="og:locale" content="en_US" /><meta name="description" content="Neste post veremos como realizar a criação de um servidor de DDNS (Dynamic DNS) para ambientes corporativos, ou seja, utilizando o seu próprio servidor de DNS e servidor Web e tendo como cliente qualquer plataforma (Windows, Linux, Unix, Android, iOS e etc...). Mas antes de começarmos a parte técnica é importante entendermos o que é o DDNS e para que serve. DDNS é o acrônimo para Dynamic Domain Name System, ou seja um DNS dinâmico, porém continua a pergunta o que isso faz? Um DNS dinâmico permite que o seu cliente possa atualizar a sua informação. Como posso usar isso na prática? Atualmente temos diversos provedores de internet de baixo custo que em geral utiliza IP váli dinâmico, ou seja, de tempos em tempos o ip é trocado. Quando usamos isso em um ambiente residencial não temos problemas, porém em um ambiente corporativo fica bem complicado de saber o ip válido de uma filial (por exemplo). Em geral para resolver este problema diversas empresas e administradores usam serviços gratuitos ou pagos para ter um DDNS como DyDNS, No-IP entre outros, para poder ter um nome legal e atualizado como filial1.no-ip.org onde toda vez que trocar o ip da filial este host estará atualizado, porém ao fazer isso você precisa instalar um cliente de terceiro em seu ambiente que nem sempre são multi-plataforma, e precisa usar um domínio (nome) atribuído pelo provedor de serviço. Sendo assim este post objetiva ensinar como fazer este mesmo processo  usando um servidor web IIS, seu servidor de DNS (qualquer um) e no lado do cliente um app qualquer que acesse uma url como wget, curl ou até um navegador como Internet Explorer, Chrome, etc... Passo 1 - Criando servidor Web Antes de iniciar se certifique que haja instalado o .NET 4.0 em seu servidor. Realize o download do arquivo DDNSWeb.zip e extraia em seu servidor web em nosso ambiente faremos isso em c:\Inetpub\DDNSWeb\.  Agora acesse a console do IIS, e crie o site conforme o exemplo abaixo Após isso se certifique que o ResourcePool do seu site está definido para utilizar o .NET 4.0 Agora veremos alguns trechos do arquivo update.aspx.cs e o que alterar para o correto funcionamento do seu servidor DDNS [sourcecode language=&quot;csharp&quot;]if (auth_key != &quot;authtest123&quot;) { Response.Status = &quot;403 Access denied&quot;; Response.StatusCode = 403; Response.End(); return; } [/sourcecode] No bloco de código acima é verificado uma chave de autenticação, essa chave é passada pelo cliente para incrementar a segurança e se certificar que o cliente pode realizar essa atualização. Com poucas alterações você pode realizar uma verificação mais rebuscada vinda de um banco de dados por exemplo. Ainda neste arquivo, você pode ver o código abaixo [sourcecode language=&quot;csharp&quot;]Dictionary&lt;String, String&gt; hosts = new Dictionary&lt;string, string&gt;(); hosts.Add(&quot;aae5cd33-5b51-49af-8b10-6e88d5af92a8&quot;, &quot;filial1&quot;); hosts.Add(&quot;759eacaa-f2d9-4324-86c4-b599a709890a&quot;, &quot;filial2&quot;); [/sourcecode] este código é na verdade uma tabela de ID versus host, onde estamos definindo um ID para cada host que desejamos atualizar, sendo assim nosso cliente passará somente o ID, e o sistema identifica qual é o host que ele deve atualizar. O próximo trecho de código que veremos é a definição da sua zona DNS e o IP do seu servidor DNS. Em nosso exemplo a zona é teste.com.br e o servidor 192.168.254.200. Existe algumas questões de segurança do servidor DNS, mas comentarei no momento que estivermos realizando a configuração do DNS. [sourcecode language=&quot;csharp&quot;]String dnsZone = &quot;teste.com.br&quot;; IPAddress server = IPAddress.Parse(&quot;192.168.254.200&quot;); [/sourcecode] Passo 2 - Servidor DNS Para que este aplicativo funcione o servidor DNS precisa permitir atualização dinâmica sem DNSSec, o que é inseguro, desta forma é altamente recomendado que você só libere isso em uma zona específica para DDNS, e que o seu servidor não libere a porta 53 TCP para a internet. Abra o gerenciador de DNS, e edite a sua zona alterando o parâmetro de atualização para permitir atualizações não seguras, conforme a imagem abaixo. Passo 3 - Configurando cliente Na pratica não existe um cliente em que você precisa fazer o download, instalar e configurar, qualquer navegador web pode ser cliente neste projeto, como Google Chrome, Wget, cURL, firefox entre outros. Esse conceito permite que usemos softwares como o wget e cURL para automatizar a requisição de tempos em tempos para sempre manter nosso host atualizado. Mas antes de chegar neste ponto irei mostrar como montar a URL para prover a atualização, testa-la no Google Chrome, assim fica facil para você entender e aplicar a mesma URL em outros navegadores como wget, cURL e etc... A url de atualização é composta basicamente por 3 partes: Host: Host do seu servidor web, pode nome dns ou IP. Host_id: ID do host conforme configurado no passo 1; Auth_key: Chave de autenticação conforme configurado no passo 1. Sendo assim a url compleca ficará assim: http://host_do_servidor/update/host_id/auth_key, usando os valores do nosso exemplo e supondo que nosso servidor web responda pelo ip 192.168.254.100 a url ficará conforme abaixo: [sourcecode language=&quot;csharp&quot;]http://192.168.254.100/update/aae5cd33-5b51-49af-8b10-6e88d5af92a8/authtest123/ [/sourcecode] Agora coloque essa URL em seu navegador preferido, em nosso teste utilizarei o Google Chrome. Se você recebeu como retorno um texto OK, isso indica que tudo está configurado corretamente e seu host foi atualizado com seu IP. Conforme a imagem abaixo o registro do tipo A com nome host1 foi criado automaticamente na minha zona de DNS e tendo como valor o meu IP." /><meta property="og:description" content="Neste post veremos como realizar a criação de um servidor de DDNS (Dynamic DNS) para ambientes corporativos, ou seja, utilizando o seu próprio servidor de DNS e servidor Web e tendo como cliente qualquer plataforma (Windows, Linux, Unix, Android, iOS e etc...). Mas antes de começarmos a parte técnica é importante entendermos o que é o DDNS e para que serve. DDNS é o acrônimo para Dynamic Domain Name System, ou seja um DNS dinâmico, porém continua a pergunta o que isso faz? Um DNS dinâmico permite que o seu cliente possa atualizar a sua informação. Como posso usar isso na prática? Atualmente temos diversos provedores de internet de baixo custo que em geral utiliza IP váli dinâmico, ou seja, de tempos em tempos o ip é trocado. Quando usamos isso em um ambiente residencial não temos problemas, porém em um ambiente corporativo fica bem complicado de saber o ip válido de uma filial (por exemplo). Em geral para resolver este problema diversas empresas e administradores usam serviços gratuitos ou pagos para ter um DDNS como DyDNS, No-IP entre outros, para poder ter um nome legal e atualizado como filial1.no-ip.org onde toda vez que trocar o ip da filial este host estará atualizado, porém ao fazer isso você precisa instalar um cliente de terceiro em seu ambiente que nem sempre são multi-plataforma, e precisa usar um domínio (nome) atribuído pelo provedor de serviço. Sendo assim este post objetiva ensinar como fazer este mesmo processo  usando um servidor web IIS, seu servidor de DNS (qualquer um) e no lado do cliente um app qualquer que acesse uma url como wget, curl ou até um navegador como Internet Explorer, Chrome, etc... Passo 1 - Criando servidor Web Antes de iniciar se certifique que haja instalado o .NET 4.0 em seu servidor. Realize o download do arquivo DDNSWeb.zip e extraia em seu servidor web em nosso ambiente faremos isso em c:\Inetpub\DDNSWeb\.  Agora acesse a console do IIS, e crie o site conforme o exemplo abaixo Após isso se certifique que o ResourcePool do seu site está definido para utilizar o .NET 4.0 Agora veremos alguns trechos do arquivo update.aspx.cs e o que alterar para o correto funcionamento do seu servidor DDNS [sourcecode language=&quot;csharp&quot;]if (auth_key != &quot;authtest123&quot;) { Response.Status = &quot;403 Access denied&quot;; Response.StatusCode = 403; Response.End(); return; } [/sourcecode] No bloco de código acima é verificado uma chave de autenticação, essa chave é passada pelo cliente para incrementar a segurança e se certificar que o cliente pode realizar essa atualização. Com poucas alterações você pode realizar uma verificação mais rebuscada vinda de um banco de dados por exemplo. Ainda neste arquivo, você pode ver o código abaixo [sourcecode language=&quot;csharp&quot;]Dictionary&lt;String, String&gt; hosts = new Dictionary&lt;string, string&gt;(); hosts.Add(&quot;aae5cd33-5b51-49af-8b10-6e88d5af92a8&quot;, &quot;filial1&quot;); hosts.Add(&quot;759eacaa-f2d9-4324-86c4-b599a709890a&quot;, &quot;filial2&quot;); [/sourcecode] este código é na verdade uma tabela de ID versus host, onde estamos definindo um ID para cada host que desejamos atualizar, sendo assim nosso cliente passará somente o ID, e o sistema identifica qual é o host que ele deve atualizar. O próximo trecho de código que veremos é a definição da sua zona DNS e o IP do seu servidor DNS. Em nosso exemplo a zona é teste.com.br e o servidor 192.168.254.200. Existe algumas questões de segurança do servidor DNS, mas comentarei no momento que estivermos realizando a configuração do DNS. [sourcecode language=&quot;csharp&quot;]String dnsZone = &quot;teste.com.br&quot;; IPAddress server = IPAddress.Parse(&quot;192.168.254.200&quot;); [/sourcecode] Passo 2 - Servidor DNS Para que este aplicativo funcione o servidor DNS precisa permitir atualização dinâmica sem DNSSec, o que é inseguro, desta forma é altamente recomendado que você só libere isso em uma zona específica para DDNS, e que o seu servidor não libere a porta 53 TCP para a internet. Abra o gerenciador de DNS, e edite a sua zona alterando o parâmetro de atualização para permitir atualizações não seguras, conforme a imagem abaixo. Passo 3 - Configurando cliente Na pratica não existe um cliente em que você precisa fazer o download, instalar e configurar, qualquer navegador web pode ser cliente neste projeto, como Google Chrome, Wget, cURL, firefox entre outros. Esse conceito permite que usemos softwares como o wget e cURL para automatizar a requisição de tempos em tempos para sempre manter nosso host atualizado. Mas antes de chegar neste ponto irei mostrar como montar a URL para prover a atualização, testa-la no Google Chrome, assim fica facil para você entender e aplicar a mesma URL em outros navegadores como wget, cURL e etc... A url de atualização é composta basicamente por 3 partes: Host: Host do seu servidor web, pode nome dns ou IP. Host_id: ID do host conforme configurado no passo 1; Auth_key: Chave de autenticação conforme configurado no passo 1. Sendo assim a url compleca ficará assim: http://host_do_servidor/update/host_id/auth_key, usando os valores do nosso exemplo e supondo que nosso servidor web responda pelo ip 192.168.254.100 a url ficará conforme abaixo: [sourcecode language=&quot;csharp&quot;]http://192.168.254.100/update/aae5cd33-5b51-49af-8b10-6e88d5af92a8/authtest123/ [/sourcecode] Agora coloque essa URL em seu navegador preferido, em nosso teste utilizarei o Google Chrome. Se você recebeu como retorno um texto OK, isso indica que tudo está configurado corretamente e seu host foi atualizado com seu IP. Conforme a imagem abaixo o registro do tipo A com nome host1 foi criado automaticamente na minha zona de DNS e tendo como valor o meu IP." /><link rel="canonical" href="https://www.helviojunior.com.br/it/building-a-ddns-server/" /><meta property="og:url" content="https://www.helviojunior.com.br/it/building-a-ddns-server/" /><meta property="og:site_name" content="Helvio Junior" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2015-01-27T20:38:52-02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Criando um servidor de DDNS" /><meta name="twitter:site" content="@helvioju" /><meta name="twitter:creator" content="@Helvio Junior (m4v3r1ck)" /><meta name="google-site-verification" content="JR4IIP9jfvOwxn2ybV_Qn0SrtDPlTrKomdPWgBuP55k"" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Helvio Junior (m4v3r1ck)"},"dateModified":"2023-08-17T00:19:29-03:00","datePublished":"2015-01-27T20:38:52-02:00","description":"Neste post veremos como realizar a criação de um servidor de DDNS (Dynamic DNS) para ambientes corporativos, ou seja, utilizando o seu próprio servidor de DNS e servidor Web e tendo como cliente qualquer plataforma (Windows, Linux, Unix, Android, iOS e etc...). Mas antes de começarmos a parte técnica é importante entendermos o que é o DDNS e para que serve. DDNS é o acrônimo para Dynamic Domain Name System, ou seja um DNS dinâmico, porém continua a pergunta o que isso faz? Um DNS dinâmico permite que o seu cliente possa atualizar a sua informação. Como posso usar isso na prática? Atualmente temos diversos provedores de internet de baixo custo que em geral utiliza IP váli dinâmico, ou seja, de tempos em tempos o ip é trocado. Quando usamos isso em um ambiente residencial não temos problemas, porém em um ambiente corporativo fica bem complicado de saber o ip válido de uma filial (por exemplo). Em geral para resolver este problema diversas empresas e administradores usam serviços gratuitos ou pagos para ter um DDNS como DyDNS, No-IP entre outros, para poder ter um nome legal e atualizado como filial1.no-ip.org onde toda vez que trocar o ip da filial este host estará atualizado, porém ao fazer isso você precisa instalar um cliente de terceiro em seu ambiente que nem sempre são multi-plataforma, e precisa usar um domínio (nome) atribuído pelo provedor de serviço. Sendo assim este post objetiva ensinar como fazer este mesmo processo  usando um servidor web IIS, seu servidor de DNS (qualquer um) e no lado do cliente um app qualquer que acesse uma url como wget, curl ou até um navegador como Internet Explorer, Chrome, etc... Passo 1 - Criando servidor Web Antes de iniciar se certifique que haja instalado o .NET 4.0 em seu servidor. Realize o download do arquivo DDNSWeb.zip e extraia em seu servidor web em nosso ambiente faremos isso em c:\\Inetpub\\DDNSWeb\\.  Agora acesse a console do IIS, e crie o site conforme o exemplo abaixo Após isso se certifique que o ResourcePool do seu site está definido para utilizar o .NET 4.0 Agora veremos alguns trechos do arquivo update.aspx.cs e o que alterar para o correto funcionamento do seu servidor DDNS [sourcecode language=&quot;csharp&quot;]if (auth_key != &quot;authtest123&quot;) { Response.Status = &quot;403 Access denied&quot;; Response.StatusCode = 403; Response.End(); return; } [/sourcecode] No bloco de código acima é verificado uma chave de autenticação, essa chave é passada pelo cliente para incrementar a segurança e se certificar que o cliente pode realizar essa atualização. Com poucas alterações você pode realizar uma verificação mais rebuscada vinda de um banco de dados por exemplo. Ainda neste arquivo, você pode ver o código abaixo [sourcecode language=&quot;csharp&quot;]Dictionary&lt;String, String&gt; hosts = new Dictionary&lt;string, string&gt;(); hosts.Add(&quot;aae5cd33-5b51-49af-8b10-6e88d5af92a8&quot;, &quot;filial1&quot;); hosts.Add(&quot;759eacaa-f2d9-4324-86c4-b599a709890a&quot;, &quot;filial2&quot;); [/sourcecode] este código é na verdade uma tabela de ID versus host, onde estamos definindo um ID para cada host que desejamos atualizar, sendo assim nosso cliente passará somente o ID, e o sistema identifica qual é o host que ele deve atualizar. O próximo trecho de código que veremos é a definição da sua zona DNS e o IP do seu servidor DNS. Em nosso exemplo a zona é teste.com.br e o servidor 192.168.254.200. Existe algumas questões de segurança do servidor DNS, mas comentarei no momento que estivermos realizando a configuração do DNS. [sourcecode language=&quot;csharp&quot;]String dnsZone = &quot;teste.com.br&quot;; IPAddress server = IPAddress.Parse(&quot;192.168.254.200&quot;); [/sourcecode] Passo 2 - Servidor DNS Para que este aplicativo funcione o servidor DNS precisa permitir atualização dinâmica sem DNSSec, o que é inseguro, desta forma é altamente recomendado que você só libere isso em uma zona específica para DDNS, e que o seu servidor não libere a porta 53 TCP para a internet. Abra o gerenciador de DNS, e edite a sua zona alterando o parâmetro de atualização para permitir atualizações não seguras, conforme a imagem abaixo. Passo 3 - Configurando cliente Na pratica não existe um cliente em que você precisa fazer o download, instalar e configurar, qualquer navegador web pode ser cliente neste projeto, como Google Chrome, Wget, cURL, firefox entre outros. Esse conceito permite que usemos softwares como o wget e cURL para automatizar a requisição de tempos em tempos para sempre manter nosso host atualizado. Mas antes de chegar neste ponto irei mostrar como montar a URL para prover a atualização, testa-la no Google Chrome, assim fica facil para você entender e aplicar a mesma URL em outros navegadores como wget, cURL e etc... A url de atualização é composta basicamente por 3 partes: Host: Host do seu servidor web, pode nome dns ou IP. Host_id: ID do host conforme configurado no passo 1; Auth_key: Chave de autenticação conforme configurado no passo 1. Sendo assim a url compleca ficará assim: http://host_do_servidor/update/host_id/auth_key, usando os valores do nosso exemplo e supondo que nosso servidor web responda pelo ip 192.168.254.100 a url ficará conforme abaixo: [sourcecode language=&quot;csharp&quot;]http://192.168.254.100/update/aae5cd33-5b51-49af-8b10-6e88d5af92a8/authtest123/ [/sourcecode] Agora coloque essa URL em seu navegador preferido, em nosso teste utilizarei o Google Chrome. Se você recebeu como retorno um texto OK, isso indica que tudo está configurado corretamente e seu host foi atualizado com seu IP. Conforme a imagem abaixo o registro do tipo A com nome host1 foi criado automaticamente na minha zona de DNS e tendo como valor o meu IP.","headline":"Criando um servidor de DDNS","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.helviojunior.com.br/it/building-a-ddns-server/"},"url":"https://www.helviojunior.com.br/it/building-a-ddns-server/"}</script><title>Criando um servidor de DDNS | Helvio Junior</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Helvio Junior"><meta name="application-name" content="Helvio Junior"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/m4v3r1ck.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Helvio Junior</a></div><div class="site-subtitle font-italic">Cyber security researcher, speaker, low level and binary exploitation entusiast. <br /><br />"I’m just a child who has never grown up. I still keep asking these 'how' & 'why' questions. Occasionally, I find an answer. Stephen Hawking"</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://www.linkedin.com/in/helviojunior" aria-label="linkedin" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.youtube.com/@Sec4US" aria-label="youtube" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="https://github.com/helviojunior" aria-label="github" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['helvio.junior','sec4us.com.br'].join('@')" aria-label="email" class="order-6" > <i class="fas fa-envelope"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/it"> It </a> </span> <span>Criando um servidor de DDNS</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Criando um servidor de DDNS</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Helvio Junior (m4v3r1ck) </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Jan 27, 2015, 8:38 PM -0200" prep="on" > Jan 27, 2015 <i class="unloaded">2015-01-27T20:38:52-02:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Aug 17, 2023, 12:19 AM -0300" prefix="Updated " > Aug 17, 2023 <i class="unloaded">2023-08-17T00:19:29-03:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="870 words">4 min</span></div></div><div class="post-content"><p>Neste post veremos como realizar a criação de um servidor de DDNS (Dynamic DNS) para ambientes corporativos, ou seja, utilizando o seu próprio servidor de DNS e servidor Web e tendo como cliente qualquer plataforma (Windows, Linux, Unix, Android, iOS e etc...).</p><p></p><p>Mas antes de começarmos a parte técnica é importante entendermos o que é o DDNS e para que serve. DDNS é o acrônimo para Dynamic Domain Name System, ou seja um DNS dinâmico, porém continua a pergunta o que isso faz? Um DNS dinâmico permite que o seu cliente possa atualizar a sua informação.</p><p>Como posso usar isso na prática? Atualmente temos diversos provedores de internet de baixo custo que em geral utiliza IP váli dinâmico, ou seja, de tempos em tempos o ip é trocado. Quando usamos isso em um ambiente residencial não temos problemas, porém em um ambiente corporativo fica bem complicado de saber o ip válido de uma filial (por exemplo).</p><p>Em geral para resolver este problema diversas empresas e administradores usam serviços gratuitos ou pagos para ter um DDNS como DyDNS, No-IP entre outros, para poder ter um nome legal e atualizado como filial1.no-ip.org onde toda vez que trocar o ip da filial este host estará atualizado, porém ao fazer isso você precisa instalar um cliente de terceiro em seu ambiente que nem sempre são multi-plataforma, e precisa usar um domínio (nome) atribuído pelo provedor de serviço.</p><p>Sendo assim este post objetiva ensinar como fazer este mesmo processo  usando um servidor web IIS, seu servidor de DNS (qualquer um) e no lado do cliente um app qualquer que acesse uma url como wget, curl ou até um navegador como Internet Explorer, Chrome, etc...</p><h2>Passo 1 - Criando servidor Web</h2><p>Antes de iniciar se certifique que haja instalado o .NET 4.0 em seu servidor.</p><p>Realize o download do arquivo <a title="DDNSWeb.zip" href="/assets/2015/01/DDNSWeb.zip">DDNSWeb.zip</a> e extraia em seu servidor web em nosso ambiente faremos isso em <strong>c:\Inetpub\DDNSWeb\. </strong></p><p>Agora acesse a console do IIS, e crie o site conforme o exemplo abaixo</p><p><a href="/assets/2015/01/site.png" class="img-link shimmer" ><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 419 403'%3E%3C/svg%3E" alt="site" data-src="/assets/2015/01/site.png" width="419" height="403" class="lazyload" data-proofer-ignore></a></p><p>Após isso se certifique que o ResourcePool do seu site está definido para utilizar o .NET 4.0</p><p><a href="/assets/2015/01/site2.png" class="img-link shimmer" ><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 514 288'%3E%3C/svg%3E" alt="site2" data-src="/assets/2015/01/site2.png" width="514" height="288" class="lazyload" data-proofer-ignore></a></p><p><span style="line-height: 1.5;">Agora veremos alguns trechos do arquivo </span><strong style="line-height: 1.5;">update.aspx.cs</strong><span style="line-height: 1.5;"> e o que alterar para o correto funcionamento do seu servidor DDNS</span></p><p>[sourcecode language="csharp"]if (auth_key != &quot;authtest123&quot;)<br /> {<br /> Response.Status = &quot;403 Access denied&quot;;<br /> Response.StatusCode = 403;<br /> Response.End();<br /> return;<br /> }<br /> [/sourcecode]</p><p>No bloco de código acima é verificado uma chave de autenticação, essa chave é passada pelo cliente para incrementar a segurança e se certificar que o cliente pode realizar essa atualização. Com poucas alterações você pode realizar uma verificação mais rebuscada vinda de um banco de dados por exemplo.</p><p>Ainda neste arquivo, você pode ver o código abaixo</p><p>[sourcecode language="csharp"]Dictionary&lt;String, String&gt; hosts = new Dictionary&lt;string, string&gt;();<br /> hosts.Add(&quot;aae5cd33-5b51-49af-8b10-6e88d5af92a8&quot;, &quot;filial1&quot;);<br /> hosts.Add(&quot;759eacaa-f2d9-4324-86c4-b599a709890a&quot;, &quot;filial2&quot;);<br /> [/sourcecode]</p><p>este código é na verdade uma tabela de ID versus host, onde estamos definindo um ID para cada host que desejamos atualizar, sendo assim nosso cliente passará somente o ID, e o sistema identifica qual é o host que ele deve atualizar.</p><p>O próximo trecho de código que veremos é a definição da sua zona DNS e o IP do seu servidor DNS. Em nosso exemplo a zona é teste.com.br e o servidor 192.168.254.200. Existe algumas questões de segurança do servidor DNS, mas comentarei no momento que estivermos realizando a configuração do DNS.</p><p>[sourcecode language="csharp"]String dnsZone = &quot;teste.com.br&quot;;<br /> IPAddress server = IPAddress.Parse(&quot;192.168.254.200&quot;);<br /> [/sourcecode]</p><h2>Passo 2 - Servidor DNS</h2><p>Para que este aplicativo funcione o servidor DNS precisa permitir atualização dinâmica sem DNSSec, o que é inseguro, desta forma é altamente recomendado que você só libere isso em uma zona específica para DDNS, e que o seu servidor não libere a porta 53 TCP para a internet.</p><p>Abra o gerenciador de DNS, e edite a sua zona alterando o parâmetro de atualização para permitir atualizações não seguras, conforme a imagem abaixo.</p><p><a href="/assets/2015/01/dns1.png" class="img-link shimmer" ><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 248 298'%3E%3C/svg%3E" alt="dns1" data-src="/assets/2015/01/dns1.png" width="248" height="298" class="lazyload" data-proofer-ignore></a></p><h2></h2><h2>Passo 3 - Configurando cliente</h2><p>Na pratica não existe um cliente em que você precisa fazer o download, instalar e configurar, qualquer navegador web pode ser cliente neste projeto, como Google Chrome, Wget, cURL, firefox entre outros. Esse conceito permite que usemos softwares como o wget e cURL para automatizar a requisição de tempos em tempos para sempre manter nosso host atualizado.</p><p>Mas antes de chegar neste ponto irei mostrar como montar a URL para prover a atualização, testa-la no Google Chrome, assim fica facil para você entender e aplicar a mesma URL em outros navegadores como wget, cURL e etc...</p><p>A url de atualização é composta basicamente por 3 partes:</p><ul><li><strong>Host</strong>: Host do seu servidor web, pode nome dns ou IP.<li><strong>Host_id</strong>: ID do host conforme configurado no passo 1;<li><strong>Auth_key</strong>: Chave de autenticação conforme configurado no passo 1.</ul><p>Sendo assim a url compleca ficará assim: http://host_do_servidor/update/host_id/auth_key, usando os valores do nosso exemplo e supondo que nosso servidor web responda pelo ip 192.168.254.100 a url ficará conforme abaixo:</p><p>[sourcecode language="csharp"]http://192.168.254.100/update/aae5cd33-5b51-49af-8b10-6e88d5af92a8/authtest123/<br /> [/sourcecode]</p><p>Agora coloque essa URL em seu navegador preferido, em nosso teste utilizarei o Google Chrome.</p><p><a href="/assets/2015/01/teste1.png" class="img-link shimmer" ><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 545 97'%3E%3C/svg%3E" alt="teste1" data-src="/assets/2015/01/teste1.png" width="545" height="97" class="lazyload" data-proofer-ignore></a><br /> Se você recebeu como retorno um texto <strong>OK</strong>, isso indica que tudo está configurado corretamente e seu host foi atualizado com seu IP.<br /> Conforme a imagem abaixo o registro do tipo A com nome host1 foi criado automaticamente na minha zona de DNS e tendo como valor o meu IP.</p><p><a href="/assets/2015/01/dns2.png" class="img-link shimmer" ><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 536 163'%3E%3C/svg%3E" alt="dns2" data-src="/assets/2015/01/dns2.png" width="536" height="163" class="lazyload" data-proofer-ignore></a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/it/'>IT</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Criando um servidor de DDNS - Helvio Junior&url=https://www.helviojunior.com.br/it/building-a-ddns-server/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Criando um servidor de DDNS - Helvio Junior&u=https://www.helviojunior.com.br/it/building-a-ddns-server/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Criando um servidor de DDNS - Helvio Junior&url=https://www.helviojunior.com.br/it/building-a-ddns-server/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.helviojunior.com.br/it/building-a-ddns-server/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/security/osint/localizando-ips-que-respondem-para-uma-url/">Localizando IPs que respondem para uma URL</a><li><a href="/security/osint/locating-url-ips-bypass-waf/">Locating IPs that respond to a URL</a><li><a href="/security/edr/instalando-elasticsearch-edr/">Instalando Elasticsearch EDR</a><li><a href="/it/instalando-openvpn-com-autenticacao-em-mysql/">Instalando OpenVPN com autenticação em MySQL</a><li><a href="/it/osce-osed-e-ecxd-certificacoes-de-desenvolvimento-de-exploits/">OSCE, OSED e eCXD: Certificações de desenvolvimento de Exploits</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/offensive-security/">Offensive Security</a> <a class="post-tag" href="/tags/pentest/">Pentest</a> <a class="post-tag" href="/tags/autoridade-certificadora/">autoridade certificadora</a> <a class="post-tag" href="/tags/ca/">ca</a> <a class="post-tag" href="/tags/certificate-authority/">certificate authority</a> <a class="post-tag" href="/tags/openssl/">openssl</a> <a class="post-tag" href="/tags/osce3/">OSCE3</a> <a class="post-tag" href="/tags/buffer-overflow/">Buffer Overflow</a> <a class="post-tag" href="/tags/osed/">OSED</a> <a class="post-tag" href="/tags/osee/">OSEE</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/it/configurando-802-1q-vlan-tagging/"><div class="card-body"> <span class="timeago small" > Mar 13, 2013 <i class="unloaded">2013-03-13T21:14:35-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Configurando 802.1q VLAN Tagging no linux</h3><div class="text-muted small"><p> 1 - Verifique se o módulo está carregado no kernel [sourcecode language="csharp"]lsmod | grep 8021q[/sourcecode] 2 - Se o módulo não tiver carregado, carregue com o seguinte comando: [sourcecode la...</p></div></div></a></div><div class="card"> <a href="/it/configurando-802-1q-vlan-tagging-no-ubuntu/"><div class="card-body"> <span class="timeago small" > Mar 18, 2013 <i class="unloaded">2013-03-18T13:20:40-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Configurando 802.1q VLAN Tagging no ubuntu até 14.04</h3><div class="text-muted small"><p> 1 - Realize a instalação do módulo [sourcecode language="shell"]sudo apt-get install vlan[/sourcecode] 2 - Verifique se o módulo está carregado no kernel [sourcecode language="shell"]lsmod | grep 8...</p></div></div></a></div><div class="card"> <a href="/it/visualizando-o-imei-de-celular-android/"><div class="card-body"> <span class="timeago small" > May 15, 2013 <i class="unloaded">2013-05-15T15:12:03-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Visualizando o IMEI de celular Android</h3><div class="text-muted small"><p> O IMEI é um número único que cada aparelho telefônico móvel sendo necessário em alguns casos para interações com sua operadora de telefonia ou registro de aplicativos. Para ver o IMEI de um smartp...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/it/mysql/criando-usuario-mysql/" class="btn btn-outline-primary" prompt="Older"><p>Criando usuário no MySQL</p></a> <a href="/it/adding-linux-hd/" class="btn btn-outline-primary" prompt="Newer"><p>Adicionando HD em um linux sem reboot</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Criando um servidor de DDNS'; this.page.url = 'https://www.helviojunior.com.br/it/building-a-ddns-server/'; this.page.identifier = '/it/building-a-ddns-server/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/helviojunior">Helvio junior (aka M4v3r1ck)</a>. <span data-toggle="tooltip" data-placement="top" title="Some rights reserved.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/offensive-security/">Offensive Security</a> <a class="post-tag" href="/tags/pentest/">Pentest</a> <a class="post-tag" href="/tags/autoridade-certificadora/">autoridade certificadora</a> <a class="post-tag" href="/tags/ca/">ca</a> <a class="post-tag" href="/tags/certificate-authority/">certificate authority</a> <a class="post-tag" href="/tags/openssl/">openssl</a> <a class="post-tag" href="/tags/osce3/">OSCE3</a> <a class="post-tag" href="/tags/buffer-overflow/">Buffer Overflow</a> <a class="post-tag" href="/tags/osed/">OSED</a> <a class="post-tag" href="/tags/osee/">OSEE</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.helviojunior.com.br{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
